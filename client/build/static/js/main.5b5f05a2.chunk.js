(this["webpackJsonp3d-conference-room"]=this["webpackJsonp3d-conference-room"]||[]).push([[0],{276:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},285:function(e,t,n){},286:function(e,t,n){},287:function(e,t,n){},289:function(e,t){},290:function(e,t){},298:function(e,t){},299:function(e,t,n){},301:function(e,t,n){"use strict";n.r(t);var i=n(21),a=n(228),r=n.n(a),o=n(152),s=n(28),c=(n(276),n(20)),d=n(10),l=n.n(d),u=n(18),h=n(9),p=n(256),m=Object(p.a)("https://www.dramalf.xyz"),f=new(n(281)),v=(n(282),n(283),"CLIENT_USER_EVENT"),b="SERVER_USER_EVENT",g="SIGNALING_OFFER",x="SIGNALING_ANSWER",j="SIGNALING_CANDIDATE",w=n(19);function y(e){var t=Object(i.useState)([]),n=Object(h.a)(t,2);n[0],n[1];function a(e){var t;t={type:"CLIENT_USER_EVENT_SEND_MESSAGE",payload:e},m.emit(v,JSON.stringify(t))}function r(e){var t=e.message,n=e.userName,i=e.isSelf,a=e.timeStamp,r=document.createElement("div"),o=document.createElement("div");return r.classList.add("msg-wrapper"),o.className="message ".concat(i?"my-message":"other-message"),o.setAttribute("data-username",i?"":n),o.setAttribute("data-time",new Date(a).toTimeString().substr(0,8)),r.appendChild(o),o.innerText=t,r}return Object(i.useEffect)((function(){var e=document.querySelector(".chat-record-panel");return m.on(b,(function(t){var n=t.type,i=t.payload;"SERVER_USER_EVENT_BROADCAST_MESSAGE"===n&&(!function(t){var n={userName:t.userName,message:t.message,isSelf:!1,timeStamp:Date.now()};e.appendChild(r(n)),e.scrollTop=e.scrollHeight}(i),console.log("revieve new msg"))})),function(){m.removeAllListeners()}}),[]),Object(w.jsxs)("div",{className:"chat-box-wrapper",children:[Object(w.jsx)("div",{className:"chat-record-panel",children:Object(w.jsx)("h4",{children:"\u804a\u5929"})}),Object(w.jsxs)("div",{className:"send-msg-part",children:[Object(w.jsx)("div",{className:"input-panel",children:Object(w.jsx)("textarea",{name:"comment",contentEditable:!0,"data-text":"\u8f93\u5165\u5185\u5bb9..."})}),Object(w.jsxs)("div",{className:"send-msg-btn",onClick:function(){var t=document.querySelector(".chat-record-panel"),n=document.querySelector(".input-panel textarea"),i=n.value;if(i){a({userName:e.userName,message:i,roomID:100});var o={userName:e.userName,message:i,isSelf:!0,timeStamp:Date.now()};t.appendChild(r(o)),t.scrollTop=t.scrollHeight,n.value=""}},children:[Object(w.jsx)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2268",width:"200",height:"200",children:Object(w.jsx)("path",{d:"M392.021333 925.013333a34.133333 34.133333 0 0 1-34.133333-34.133333V579.242667c0-10.24 4.608-19.968 12.629333-26.453334l276.48-224.085333a34.0992 34.0992 0 0 1 43.008 52.906667L426.154667 595.456v192.853333l82.944-110.592c10.069333-13.482667 28.672-17.578667 43.52-9.557333l137.557333 73.728L853.333333 156.16c3.242667-11.434667-3.413333-18.602667-6.485333-21.162667-3.072-2.56-11.093333-7.850667-21.845333-2.901333L206.336 422.4l80.213333 46.08c16.384 9.386667 22.016 30.208 12.629334 46.592s-30.208 22.016-46.592 12.629333l-137.045334-78.677333a33.979733 33.979733 0 0 1-17.066666-31.061333c0.512-12.8 8.021333-24.064 19.626666-29.525334L795.989333 70.314667c31.744-14.848 68.096-10.069333 94.890667 12.629333a87.790933 87.790933 0 0 1 28.16 91.477333L744.277333 801.28a34.082133 34.082133 0 0 1-48.981333 20.821333L546.133333 742.058667l-126.805333 169.301333c-6.656 8.704-16.896 13.653333-27.306667 13.653333z","p-id":"2269",fill:"#e6e6e6"})}),"                "]})]})]})}n(285);var _=function(e){return Object(w.jsx)("div",{className:"tips-wrapper",children:Object(w.jsxs)("div",{className:"tips-box",children:[Object(w.jsx)("h4",{children:"\u63d0\u793a"}),Object(w.jsxs)("div",{className:"info-box",children:[" ",Object(w.jsx)("div",{children:"\u4f1a\u8bae\u671f\u95f4\u4f1a\u4f7f\u7528\u5230\u60a8\u7684\u6444\u50cf\u5934\u6216\u9ea6\u514b\u98ce"}),Object(w.jsx)("div",{children:"\u89c2\u4f17\u53ef\u4ee5\u9009\u62e9VR\u6a21\u5f0f\u65c1\u542c\u4f1a\u8bae"}),Object(w.jsx)("div",{children:"\u58f0\u63a7\u548c\u624b\u52bf\u8bc6\u522b\u529f\u80fd\u53ef\u6839\u636e\u4e2a\u4eba\u9700\u8981\u548c\u8bbe\u5907\u6027\u80fd\u9009\u62e9\u5f00\u542f"})]}),Object(w.jsx)("div",{className:"tips-enter-btn",children:"\u8fdb\u5165\u4f1a\u8bae"})]})})};n(286);function E(e){return Object(w.jsxs)("div",{className:"button r",id:"button-9",children:[Object(w.jsx)("input",{type:"checkbox",className:"checkbox",onClick:function(t){var n=t.target.checked;e.onToggle(n)}}),Object(w.jsx)("div",{className:"knobs","data-l":e.l,"data-r":e.r,children:Object(w.jsx)("span",{})}),Object(w.jsx)("div",{className:"layer"})]})}n(287);function O(e){return Object(w.jsxs)("div",{className:"user-list-wrapper",children:[Object(w.jsx)("h4",{children:"\u4e0e\u4f1a\u5217\u8868"}),Object(w.jsx)("div",{className:"user-list-box",children:e.participantsList.map((function(e){return Object(w.jsx)("div",{"data-name":e,children:e},e.toString())}))})]})}var k=n(3),S=n(7),N=n(8),R=n(159),T=n(232),L=n(233),C=n(234),A=n(165),I=n(166),V=[],D=new N.a("rgb(64,64,64)",.2),U=new N.hb("rgb(240, 225, 240)",1);U.position.set(0,20,0);var z=new N.Ab("rgb(255, 255, 255)",1,200,Math.PI,0,0);z.castShadow=!0,z.position.set(0,200,0),V.push(z,U);var M=n(235),P=function(){function e(t){var n=this,i=arguments.length>2?arguments[2]:void 0;Object(k.a)(this,e),this.dom=void 0,this.renderer=void 0,this.mixer=void 0,this.pmremGenerator=void 0,this.scene=void 0,this.raycaster=void 0,this.camera=void 0,this.ambientLight=void 0,this.clock=void 0,this.centralpoint=new N.Jb(0,0),this.controls=void 0,this.seatsPosition=[{x:0,y:29,z:20},{x:-20,y:29,z:-20},{x:0,y:29,z:-20},{x:26,y:29,z:-20},{x:38,y:29,z:0},{x:-38,y:29,z:0}],this.userVideoBoxes=[],this.model=void 0,this.heart=void 0,this.VRviewBody=void 0,this.newEnterIndex=0,this.stats=void 0,this.dom=t,this.renderer=new N.Nb({antialias:!0}),this.renderer.xr.enabled=!0,this.clock=new N.j,this.renderer.shadowMap.enabled=!0,this.renderer.toneMapping=N.K,this.ambientLight=D,this.scene=new N.vb,this.scene.add(this.ambientLight);var a=new N.db(this.renderer);a.compileEquirectangularShader(),this.pmremGenerator=a;var r=this.scene,o=new N.ab;o.position.set(0,28,0),this.VRviewBody=o,(new I.a).setDataType(N.Ib).load("/texture/autumn_forest_04_1k.hdr",(function(e){var t=a.fromEquirectangular(e).texture;a.dispose(),console.log("here"),r.environment=t,r.background=t}),(function(){}),(function(e){console.log("error in load env_texture",e)})),this.camera=new N.eb(60,t.offsetWidth/t.offsetHeight,1,1e3),this.renderer.setSize(t.offsetWidth,t.offsetHeight,!0);var s,c=Object(T.a)(),d=c.domElement;this.stats=c,d.style.position="fixed",d.style.top="0",d.style.right="5px",d.style.left="unset";var l="oculus"===i||"android"===i||"ios"===i;l?((s=new L.a(this.camera,this.dom)).enableDamping=!0,s.dampingFactor=.05,s.screenSpacePanning=!1,s.target=new N.Kb(0,28,0),s.maxPolarAngle=Math.PI/2+.001,s.minPolarAngle=Math.PI/2,s.update()):((s=new C.a(this.camera,this.dom)).lookSpeed=.2,s.movementSpeed=20,s.constrainVertical=!0,s.verticalMin=Math.PI/2,s.verticalMax=Math.PI/2+1e-7),this.controls=s,this.controls.object.position.set(0,28,20),this.controls.object.lookAt(new N.Kb(0,0,0)),this.camera.up=new N.Kb(0,1,0),l&&this.controls.update();var u=new N.tb;this.raycaster=u;var h=function(){n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(t.offsetWidth,t.offsetHeight,!0)};window.addEventListener("resize",h),this.renderer.setAnimationLoop((function(){!l&&n.controls.update(n.clock.getDelta()),l&&n.controls.update(),n.renderer.render(n.scene,n.camera),c.update(),R.b(),n.updateUserVideoRotation()})),t.appendChild(this.renderer.domElement),t.appendChild(d),t.appendChild(M.a.createButton(this.renderer))}return Object(S.a)(e,[{key:"loadRoom",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=new A.a;n.load("/models/table/scene.gltf",(function(n){n.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.frustumCulled=!1,e.material.emissive=e.material.color,e.material.emissiveMap=e.material.map)})),n.scene.receiveShadow=!0,e.model=n.scene,e.scene.add(n.scene),n.scene.position.set(0,0,0),n.scene.scale.set(.3,.3,.3),t()}),(function(){}),(function(e){console.log("error",e)}))}},{key:"switchVRview",value:function(e){e?this.VRviewBody.add(this.camera):this.VRviewBody.remove(this.camera)}},{key:"getCentralUser",value:function(){this.raycaster.setFromCamera(this.centralpoint,this.camera);for(var e,t=this.raycaster.intersectObjects(this.scene.children),n=0;n<t.length;n++)e=t[n].object.name;return e}},{key:"load_sprite",value:function(){var e=this,t=new N.bb;console.log("120"),t.load("/models/sprite/sprite.json",(function(t){e.scene.add(t),t.position.set(-29,30,-20),t.scale.set(10,10,10),console.log(t,120)}),(function(){}),(function(e){console.log("error",e)}))}},{key:"addObject",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach((function(t){e.scene.add(t)}))}},{key:"updateUserVideoRotation",value:function(){var e=this;this.userVideoBoxes.map((function(t,n){if(t){var i=t.object,a=e.camera.position.clone(),r=i.position.clone(),o=Math.atan((r.x-a.x)/(r.z-a.z));i.rotation.y=o}}))}},{key:"changeScene",value:function(e){var t=this;(new I.a).setDataType(N.Ib).load("/texture/".concat(e,".hdr"),(function(e){var n=t.pmremGenerator.fromEquirectangular(e).texture;t.pmremGenerator.dispose(),t.scene.environment=n,t.scene.background=n}),(function(){}),(function(e){console.log("123,",e)}))}},{key:"addUserVideo",value:function(e,t){var n=new N.gb(48,36,96,72),i=new N.Mb(e);i.format=N.pb;var a=new N.S({map:i,transparent:!0,side:N.o});a.needsUpdate=!0;var r=new N.R(n,a);r.name=t;var o=this.seatsPosition[this.newEnterIndex],s=o.x,c=o.y,d=o.z;this.newEnterIndex++,r.position.set(s,c,d),r.scale.set(.4,.4,.4),this.userVideoBoxes.push({object:r,videoName:t}),this.scene.add(r)}},{key:"removeUserVideo",value:function(e){var t=this;this.userVideoBoxes=this.userVideoBoxes.filter((function(n){return n.videoName===e&&(console.log("997",n),n.object.material.dispose(),n.object.geometry.dispose(),t.scene.remove(n.object)),n.videoName!==e}))}},{key:"adjustBrightness",value:function(e){"brighter"===e?(console.log("\u4eae\u4e00\u70b9"),this.renderer.toneMappingExposure+=.1):(console.log("\u6697\u4e00\u70b9"),this.renderer.toneMappingExposure-=.1)}},{key:"startLove",value:function(e,t){var n,i,a=this.heart.clone();this.scene.add(a);var r=null===(n=this.userVideoBoxes.find((function(t){return t.videoName===e})))||void 0===n?void 0:n.object.position.clone(),o=null===(i=this.userVideoBoxes.find((function(e){return e.videoName===t})))||void 0===i?void 0:i.object.position.clone();if("&&SELF"===e&&(r=this.camera.position.clone()),r&&o){r.y=24,o.y=24;var s=new N.Kb(r.x/2-o.x/2-2,32,r.z/2-o.z/2-6),c=new N.mb(r,s,o).getPoints(50),d=this.scene,l=function(e){var t=e.map((function(t,n,i){if(n<e.length-2){var r=new R.a(t).to(i[n+1],10);return r.onUpdate((function(e){a.position.set(e.x,e.y,e.z)})),r}if(n===e.length-2){var o=new R.a(t).to(i[n+1],10);return o.onUpdate((function(){d.remove(a)})),o}}));t.pop();for(var n=0;n<e.length-1;n++)t[n+1]&&t[n]&&t[n].chain(t[n+1]);return t[0]}(c);null===l||void 0===l||l.start()}}},{key:"loadLove",value:function(){var e=this;(new A.a).load("/models/heart_in_love/scene.gltf",(function(t){t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.frustumCulled=!1,e.material.emissive=e.material.color,e.material.emissiveMap=e.material.map)})),t.scene.receiveShadow=!0,e.heart=t.scene,t.scene.scale.set(.01,.01,.01)}),(function(){}),(function(e){console.log("error",e)}))}},{key:"disableControls",value:function(){this.controls.enabled=!1}},{key:"enableControls",value:function(){this.controls.enabled=!0}}]),e}(),B=n(168),G=(n(300),function(){function e(){Object(k.a)(this,e),this.gestures={openPlam:{keypoints:[{x:527.9091230562565,y:521.0406841419879,name:"wrist"},{x:456.2807815622871,y:503.0127886486822,name:"thumb_cmc"},{x:409.9258107905914,y:453.83136706486096,name:"thumb_mcp"},{x:399.9838723622642,y:397.80269690754363,name:"thumb_ip"},{x:404.2601322964012,y:352.733005759806,name:"thumb_tip"},{x:391.89745346202676,y:424.9564693061705,name:"index_finger_mcp"},{x:330.8528899353995,y:344.57204064346183,name:"index_finger_pip"},{x:292.0213106618285,y:286.5198725763419,name:"index_finger_dip"},{x:257.8089845653416,y:239.55721912145168,name:"index_finger_tip"},{x:449.7284131728093,y:416.88567083621336,name:"middle_finger_mcp"},{x:433.10611425385207,y:287.9674767660912,name:"middle_finger_pip"},{x:419.0225843013024,y:203.85083349289098,name:"middle_finger_dip"},{x:404.1351913134992,y:143.48506497753527,name:"middle_finger_tip"},{x:514.0518507153616,y:419.37081567152734,name:"ring_finger_mcp"},{x:537.2266617051833,y:294.9893689874851,name:"ring_finger_pip"},{x:538.0877401382181,y:210.49916531436995,name:"ring_finger_dip"},{x:537.3729875673654,y:148.6602971411435,name:"ring_finger_tip"},{x:568.5880405624539,y:430.1912609597638,name:"pinky_finger_mcp"},{x:595.80688016865,y:379.5906582307573,name:"pinky_finger_pip"},{x:606.4642624396802,y:380.4839605696293,name:"pinky_finger_dip"},{x:615.8822669063884,y:381.99105962903826,name:"pinky_finger_tip"}],keypoints3D:[{x:.024291463976102275,y:.04706618694861017,z:.0684986561536789,name:"wrist"},{x:.0013181784842062321,y:.02858571814555528,z:.04906672239303589,name:"thumb_cmc"},{x:-.00792290007287188,y:.014263559570490181,z:.03756839036941528,name:"thumb_mcp"},{x:-.009724975250556002,y:-.001968791059482895,z:.006983112543821335,name:"thumb_ip"},{x:-.009035289177010554,y:-.01704422039573432,z:-.007673956453800201,name:"thumb_tip"},{x:-.009226183238666983,y:.006526046040007371,z:-.0012988932430744171,name:"index_finger_mcp"},{x:-.035690459548791506,y:-.010919095394759737,z:-.005468373186886311,name:"index_finger_pip"},{x:-.050869090878542855,y:-.028686547686333212,z:-.019602525979280472,name:"index_finger_dip"},{x:-.061546791711189125,y:-.0428273248678893,z:-.03161431849002838,name:"index_finger_tip"},{x:-.003312389026670696,y:.004445856054086265,z:.0008503459393978119,name:"middle_finger_mcp"},{x:-.01247337094911538,y:-.027892787967230867,z:-.009020786732435226,name:"middle_finger_pip"},{x:-.018162415088423537,y:-.05029917813544822,z:-.015433765947818756,name:"middle_finger_dip"},{x:-.032113432185902825,y:-.07820429470056996,z:-.004696410149335861,name:"middle_finger_tip"},{x:.00983112498225417,y:-.007950719871017985,z:-.001078881323337555,name:"ring_finger_mcp"},{x:.010367577791061313,y:-.029685706562936648,z:.002013266086578369,name:"ring_finger_pip"},{x:.013941904876090962,y:-.06440187171550504,z:.001839280128479004,name:"ring_finger_dip"},{x:.013301820163690255,y:-.08799677484684626,z:-.0029235854744911194,name:"ring_finger_tip"},{x:.022169293997946912,y:-.0007543127232017416,z:.009144721552729607,name:"pinky_finger_mcp"},{x:.026750486362560964,y:-.005371706799819841,z:.011953644454479218,name:"pinky_finger_pip"},{x:.02917335594483131,y:-.008743876222298233,z:.013476628810167313,name:"pinky_finger_dip"},{x:.03338556358486299,y:-.0018176424280466272,z:.0139746880158782,name:"pinky_finger_tip"}],handedness:"Left",score:.9569462537765503}}}return Object(S.a)(e,[{key:"normalize",value:function(e){var t=e.keypoints,n=(e.keypoints3D,0),i=0;t.map((function(e){n+=e.x,i+=e.y})),n/=t.length,i/=t.length;var a=0;t.map((function(e){a+=Math.pow(e.x-n,2)+Math.pow(e.y-i,2)})),a/=t.length;var r=Math.sqrt(a);return t.map((function(e){return{x:(e.x-n)/r,y:(e.y-i)/r}}))}},{key:"calcCorrelation",value:function(e,t){for(var n,i=e.length,a=0,r=0,o=0,s=0;s<i;s++)a+=e[s].x*t[s].x+e[s].y*t[s].y,r+=e[s].x*e[s].x+e[s].y*e[s].y,o+=t[s].x*t[s].x+t[s].y*t[s].y;a*=i;var c=0,d=0;e.map((function(e){c+=e.x,d+=e.y}));var l=0,u=0;t.map((function(e){l+=e.x,u+=e.y})),n=c*l+d*u,r=Math.sqrt(r-c*c-d*d),o=Math.sqrt(o-l*l-u*u),console.log((a-n)/(r*o))}}]),e}()),q=function(){function e(){Object(k.a)(this,e),this.handDetector=void 0,this.detectVideo=void 0,this.gestureRecognition=new G,this.enable=!1}return Object(S.a)(e,[{key:"createDetector",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(this.gestureRecognition),t=B.a.MediaPipeHands,n={runtime:"tfjs",modelType:"full"},e.next=5,B.b(t,n);case 5:return i=e.sent,this.handDetector=i,console.log(i),e.abrupt("return",this);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bindVideo",value:function(e){return this.detectVideo=e,this}},{key:"onDetect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};setInterval(Object(u.a)(l.a.mark((function n(){var i,a,r,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.enable){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e.handDetector.estimateHands(e.detectVideo);case 4:(i=n.sent)[0]&&(a=i[0].keypoints3D[3],r=i[0].keypoints3D[7],o=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)),console.log(o),o<.05&&(console.log("\u6bd4\u5fc3"),t()));case 6:case"end":return n.stop()}}),n)}))),30)}}]),e}(),F=new N.Fb,H=F.load("./texture/wood.jpeg");H.wrapS=N.ub,H.wrapT=N.ub,H.repeat.set(10,4);var W=F.load("./texture/wall2.jpg");W.wrapS=N.ub,W.wrapT=N.ub,W.repeat.set(10,4);var J=[];new N.R(new N.f(10,20,10),new N.U({map:H})).position.x=0;var X=new N.R(new N.f(200,10,200),new N.U({map:H}));X.castShadow=!0,X.receiveShadow=!0,X.position.y=-5;var Y=new N.R(new N.f(2,10,2),new N.U({color:"#b57355",metalness:.5,roughness:.3}));Y.castShadow=!0,Y.receiveShadow=!0,Y.position.set(-10,5,-10),new N.R(new N.fb(100,40),new N.U({map:W,side:N.o})).position.set(0,20,-50);var K=new N.R(new N.fb(100,40),new N.U({map:W,side:N.o}));K.rotateY(Math.PI/2),K.position.set(-50,20,0);var Q=new N.R(new N.fb(100,40),new N.U({map:W,side:N.o}));Q.rotateY(Math.PI/2),Q.position.set(50,20,0),new N.R(new N.fb(100,40),new N.U({map:W,side:N.o})).position.set(0,20,50),J.push(X);var Z=[],$=(new N.c(500),new N.t(500,20,"rgb(200, 200, 200)","rgb(100, 100, 100)"),new N.ib(U,U.distance,U.color),new N.Bb(z,z.color),n(161)),ee=window.webkitSpeechRecognition,te=function e(){var t=this;Object(k.a)(this,e),this.recognition=new ee,this.listenedEvent=[],this.stop=function(){t.recognition.stop()},this.start=function(){t.recognition.start()},this.bindListening=function(e,n){t.listenedEvent.push({keyword:e,callback:n})},this.recognition.continuous=!0,this.recognition.lang="cmn-Hans-CN",this.recognition.interimResults=!0;var n="",i=!1;this.recognition.onresult=function(e){var a=e.resultIndex,r=e.results[a][0].transcript;if(console.log(r),r.length&&!i){var o=r.length;n=r.substr(o-10?o-10:0,o-10?10:o),t.listenedEvent.some((function(e){var t=e.keyword,a=e.callback;n.indexOf(t)>=0&&(i=!0,setTimeout((function(){i=!1}),2e3),a())}))}}},ne=function(){function e(t,n){var i=this;Object(k.a)(this,e),this.peerList={},this.videoList={},this.userName=void 0,this.local_video=void 0,this.is_audience=!1,this.socket=void 0,this.ee=void 0,this.onnewuserenterroom=void 0,this.onnewvideoloaded=void 0,this.onuserleaveroom=void 0,this.onuserinteraction=void 0,this.ee=n,this.socket=t,t.on("FIRSTASKLIST",(function(e){console.log("User first time get all online users list");var t=JSON.parse(e);i.onnewuserenterroom&&i.onnewuserenterroom(t),i.initRTC(t.onlineUsers)})),t.on("user_leave",(function(e){console.log("in rtc "),i.onuserleaveroom&&i.onuserleaveroom(e)})),t.on("INTERACTION_EVENT",(function(e){console.log(e,"shoot"),i.onuserinteraction&&i.onuserinteraction(e)})),t.on(b,(function(e){var t=e.type,n=e.payload;if("SERVER_USER_EVENT_UPDATE_USERS"===t)i.onnewuserenterroom&&i.onnewuserenterroom(n)})),t.on("SERVER_RTC_EVENT",function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.type,e.t0=n,e.next=e.t0===g?4:e.t0===x?6:e.t0===j?9:12;break;case 4:return i.handleReceiveOffer(t),e.abrupt("break",12);case 6:return e.next=8,i.handleReceiveAnswer(t);case 8:case 11:return e.abrupt("break",12);case 9:return e.next=11,i.handleReceiveCandidate(t);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}return Object(S.a)(e,[{key:"initRTC",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.local_video,n=this.is_audience,t.length>1&&t.forEach((function(e){var t=e.userName;if(!i.peerList[t]&&t!==i.userName){var a=i.createPeerConnection(t);if(i.peerList[t]=a,!n){var r=i.local_video.srcObject;r.getTracks().forEach((function(e){a.addTrack(e,r)}))}}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(e,t,n){n?(this.is_audience=!1,this.local_video=n):this.is_audience=!0,this.userName=e;var i={type:"CLIENT_USER_EVENT_LOGIN",payload:{loginName:e,roomID:100}};this.socket.emit(v,JSON.stringify(i))}},{key:"createPeerConnection",value:function(e){var t=this,n=this.userName,i=new RTCPeerConnection({iceServers:[{url:"stun:stun.ekiga.net"},{url:"turn:turnserver.com",username:"user",credential:"pass"}]}),a=function(){var a=Object(u.a)(l.a.mark((function a(r){var o;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.createOffer();case 2:return o=a.sent,a.next=5,i.setLocalDescription(o);case 5:console.log(i.localDescription,"996 sdp"),t.sendRTCEvent({type:g,payload:{from:n,target:e,sdp:i.localDescription}});case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),r=function(){var i=Object(u.a)(l.a.mark((function i(a){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a.candidate&&t.sendRTCEvent({type:j,payload:{from:n,target:e,candidate:a.candidate}});case 1:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}();return i.onnegotiationneeded=a,i.onicecandidate=r,i.ontrack=function(n){var i=t.videoList[e];if(i){if(i.srcObject)return;i.srcObject=n.streams[0]}else(i=document.createElement("video")).srcObject=n.streams[0],i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.width=640,i.height=480,t.videoList[e]=i,i.play(),t.onnewvideoloaded&&t.onnewvideoloaded({video:i,video_name:e}),console.log(110,e)},i}},{key:"handleReceiveOffer",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i,a,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.payload.sdp,i=t.payload.from,console.log(i,t,"120"),!this.peerList[i]){e.next=5;break}return e.abrupt("return");case 5:return a=this.createPeerConnection(i),this.peerList[i]=a,e.next=9,a.setRemoteDescription(n);case 9:return!this.is_audience&&this.local_video&&(r=this.local_video.srcObject).getTracks().forEach((function(e){a.addTrack(e,r)})),e.next=12,a.createAnswer();case 12:return o=e.sent,e.next=15,a.setLocalDescription(o);case 15:this.sendRTCEvent({type:x,payload:{sdp:o,from:this.userName,target:i}});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleReceiveAnswer",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.peerList,i=t.payload.sdp,a=t.payload.from,"stable"===n[a].signalingState){e.next=6;break}return e.next=6,n[a].setRemoteDescription(i);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleReceiveCandidate",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.peerList[t.payload.from].addIceCandidate(t.payload.candidate);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRTCEvent",value:function(e){this.socket&&this.socket.emit("CLIENT_RTC_EVENT",JSON.stringify(e))}},{key:"sendUserEvent",value:function(e){this.socket&&this.socket.emit(v,JSON.stringify(e))}}]),e}();var ie=function(){var e=Object(s.e)(),t=e.state,n=t.isAudience,a=t.browserType,r={"\u6797\u95f4\u6668\u5149":"autumn_forest_04_1k","\u9ec4\u660f\u90ca\u91ce":"railway_bridges_1k","\u5b81\u9759\u6e56\u7554":"bell_park_pier_1k"},o=Object(i.useState)([""]),d=Object(h.a)(o,2),p=d[0],b=d[1],g=Object(i.useState)(e.state.username),x=Object(h.a)(g,2),j=x[0],k=(x[1],Object(i.useState)("\u6797\u95f4\u6668\u5149")),S=Object(h.a)(k,2),N=S[0],R=S[1];function T(){return L.apply(this,arguments)}function L(){return(L=Object(u.a)(l.a.mark((function e(){var t,n,i,a,r,o,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.load(!0,!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("in humanseg",e.t0);case 8:return e.next=10,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 10:return t=e.sent,n=t.getVideoTracks()[0].getSettings().width/2,i=t.getVideoTracks()[0].getSettings().height/2,(a=document.createElement("canvas")).width=n,a.height=i,(r=document.createElement("canvas")).width=n,r.height=i,(o=document.createElement("canvas")).width=n,o.height=i,(s=document.createElement("video")).muted=!0,s.autoplay=!0,s.width=n,s.height=i,(c=document.createElement("video")).width=n,c.height=i,s.srcObject=t,s.play(),c.srcObject=a.captureStream(),C(s,a,r,o,(function(){})),f.emit("LOCAL_VIDEO",s),c.onloadeddata=function(){console.log("seg loaded"),c.play(),f.emit("VIDEO_READY",c,j)},e.abrupt("return",c);case 37:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function C(e,t,n,i){return A.apply(this,arguments)}function A(){return A=Object(u.a)(l.a.mark((function e(t,n,i,a){var r,o,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=function(){return(o=Object(u.a)(l.a.mark((function e(){var i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.getGrayValue(t);case 3:i=e.sent,a=i.data,$.drawHumanSeg(a,n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:requestAnimationFrame(r);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)},r=function(){return o.apply(this,arguments)},s.length>4&&void 0!==s[4]?s[4]:function(e){},n.classList.add("testa"),r();case 5:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}return Object(i.useEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new ne(m,f)).onnewuserenterroom=function(e){console.log("\u6709\u4eba\u6765\u4e86",e),b(e.onlineUsers.map((function(e){return e.userName})))},t.onnewvideoloaded=function(e){console.log("\u89c6\u9891\u51c6\u5907\u597d\u4e86",e);var t=e.video,n=e.video_name;f.emit("VIDEO_READY",t,n)},t.onuserleaveroom=function(e){f.emit("USER_LEAVE",e)},t.onuserinteraction=function(e){f.emit("START_LOVE",e)},e.next=7,new Promise((function(e,t){n?(document.querySelector(".tips-wrapper").style.display="none",e(0)):document.querySelector(".tips-enter-btn").onclick=function(){document.querySelector(".tips-wrapper").style.display="none",e(0)}}));case 7:if(e.t0=t,e.t1=j,!n){e.next=13;break}e.t2=void 0,e.next=16;break;case 13:return e.next=15,T();case 15:e.t2=e.sent;case 16:e.t3=e.t2,e.t0.login.call(e.t0,e.t1,"100",e.t3);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(i.useEffect)((function(){var e=document.querySelector(".conference-webgl-wrapper"),t=new P(e,n,a);t.loadRoom((function(){var e;null===(e=document.querySelector(".mask"))||void 0===e||e.classList.remove("mask")})),t.addObject.apply(t,Object(c.a)(J)),t.addObject.apply(t,Object(c.a)(V)),t.addObject.apply(t,Object(c.a)(Z)),t.loadLove(),f.on("TRIGGER_GESTURE",(function(){var e=t.getCentralUser();e&&t.startLove("&&SELF",e);var n={type:"CLIENT_USER_EVENT_INTERACTION",payload:{from:j,to:e}};e&&m.emit(v,JSON.stringify(n))})),f.on("CHANGE_SCENE",(function(e){t.changeScene(e)})),f.on("ADJUST_BRIGHTNESS",(function(e){t.adjustBrightness(e)})),f.on("USER_LEAVE",(function(e){t.removeUserVideo(e)})),f.on("SWITCH_VR",(function(e){t.switchVRview(e)})),f.on("START_LOVE",(function(e){t.startLove(e,j)})),f.on("VIDEO_READY",(function(e,n){console.log(e,n);var i=document.createElement("video");i.width=e.width,i.muted=!0,i.height=e.height,function(e,t){var n=document.createElement("canvas"),i=document.createElement("canvas");i.width=320,i.height=240,t.srcObject=n.captureStream();var a=n.getContext("webgl"),r=a.createShader(a.VERTEX_SHADER);a.shaderSource(r,"attribute vec2 c; void main(void) { gl_Position=vec4(c, 0.0, 1.0); }"),a.compileShader(r);var o=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(o,document.getElementById("fragment-shader").innerText),a.compileShader(o);var s=a.createProgram();a.attachShader(s,r),a.attachShader(s,o),a.linkProgram(s),a.useProgram(s);var c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,1,1]),a.STATIC_DRAW);var d=a.getAttribLocation(s,"c");a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(d),a.activeTexture(a.TEXTURE0);var l=a.createTexture();a.bindTexture(a.TEXTURE_2D,l),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);var u=a.getUniformLocation(s,"tex"),h=a.getUniformLocation(s,"texWidth"),p=a.getUniformLocation(s,"texHeight");e.requestVideoFrameCallback((function t(i,r){n.width=r.width,n.height=r.height,a.viewport(0,0,r.width,r.height),a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,e),a.uniform1i(u,0),a.uniform1f(h,r.width),a.uniform1f(p,r.height),a.drawArrays(a.TRIANGLE_FAN,0,4),e.requestVideoFrameCallback(t)})),console.log("\u6267\u884c\u4e86")}(e,i),i.onloadeddata=function(){i.play(),t.addUserVideo(i,n)}})),window.addEventListener("keydown",(function(e){27===e.keyCode?t.disableControls():17===e.keyCode&&t.enableControls()}))}),[]),Object(i.useEffect)((function(){if(window.webkitSpeechRecognition){var e=new te;e.start(),console.log("vc open"),e.bindListening("\u4eae\u4e00\u70b9",(function(){console.log("\u6355\u6349\u5230\u4e86>>>\u4eae\u4e00\u70b9"),f.emit("ADJUST_BRIGHTNESS","brighter")})),e.bindListening("\u6697\u4e00\u70b9",(function(){console.log("\u6355\u6349\u5230\u4e86>>>\u6697\u4e00\u70b9"),f.emit("ADJUST_BRIGHTNESS","darker")}))}}),[]),Object(i.useEffect)((function(){var e=new q;f.on("LOCAL_VIDEO",function(){var t=Object(u.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createDetector();case 2:t.sent.bindVideo(n).onDetect((function(){f.emit("TRIGGER_GESTURE"),console.log("***&&&")}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),f.on("SWITCH_DETECT",(function(t){e.enable=t}))}),[]),Object(w.jsxs)("div",{className:"App sm-app",children:[Object(w.jsxs)("div",{className:"app-main-box sm-app-main-box",children:[Object(w.jsxs)("div",{className:"conference-header-wrapper",children:[Object(w.jsxs)("div",{className:"header-item",onClick:function(){},children:["\u6b22\u8fce",j]}),Object(w.jsxs)("div",{className:"header-item dropdown",children:[Object(w.jsx)("h5",{children:N}),Object(w.jsx)("div",{className:"dropdown-content",children:Object.keys(r).map((function(e){return Object(w.jsx)("p",{onClick:function(){R(e),f.emit("CHANGE_SCENE",r[e])},children:e})}))})]}),Object(w.jsx)("div",{className:"header-item",children:Object(w.jsx)(E,{l:"VR",r:"2d",onToggle:function(e){f.emit("SWITCH_VR",e)}})}),Object(w.jsx)("div",{className:"header-item",children:Object(w.jsx)(E,{l:"\ud83e\udd1e\ud83c\udfff",r:"\ud83d\udeab",onToggle:function(e){f.emit("SWITCH_DETECT",e)}})})]}),Object(w.jsxs)("div",{className:"conference-body-wrapper mask","data-loadinfo":"\u4e09\u7ef4\u4f1a\u8bae\u5ba4\u52a0\u8f7d\u4e2d",children:[Object(w.jsx)(_,{}),Object(w.jsx)("div",{className:"conference-webgl-wrapper"})]}),Object(w.jsxs)("div",{className:"conference-footer-wrapper",onClick:function(){},children:[Object(w.jsx)("div",{className:"function-btn selected",onClick:function(e){var t,n=e.target,i=n.classList.contains("selected"),a=document.querySelector(".conference-textchat-wrapper"),r=(null===(t=document.querySelector(".userlist-btn"))||void 0===t?void 0:t.classList.contains("selected"))&&!i;r&&a.classList.add("add-space"),!r&&a.classList.remove("add-space"),console.log(r),i?(n.classList.remove("selected"),a.classList.add("hide")):(n.classList.add("selected"),a.classList.remove("hide"))},children:"\ud83d\udcac"}),Object(w.jsx)("div",{className:"userlist-btn function-btn ",onClick:function(e){var t=e.target,n=t.classList.contains("selected"),i=document.querySelector(".conference-participants-list-wrapper"),a=document.querySelector(".conference-textchat-wrapper"),r=!a.classList.contains("hide")&&!n;r&&a.classList.add("add-space"),!r&&a.classList.remove("add-space"),n?(t.classList.remove("selected"),i.classList.add("hide")):(t.classList.add("selected"),i.classList.remove("hide"))},children:"\ud83d\udc65"})]})]}),Object(w.jsxs)("div",{className:"app-function-box sm-app-function-box",children:[Object(w.jsx)("div",{className:"conference-participants-list-wrapper sm-conference-participants-list-wrapper hide",children:Object(w.jsx)(O,{participantsList:p})}),Object(w.jsx)("div",{className:"conference-textchat-wrapper sm-conference-textchat-wrapper",children:Object(w.jsx)(y,{userName:j})})]})]})};n(299);function ae(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n="unknown";return t(/oculus|quest/gi)?n="oculus":t(/windows|win32|win64|wow32|wow64/gi)?n="windows":t(/macintosh|macintel/gi)?n="osx":t(/x11/gi)?n="linux":t(/android|adr/gi)?n="android":t(/ios|iphone|ipad|ipod|iwatch/gi)&&(n="ios"),n}var re=ae();var oe=function(){var e=Object(s.f)();return Object(w.jsxs)("div",{className:"login-wrapper",children:[Object(w.jsxs)("div",{className:"login-form-wrapper",children:[Object(w.jsx)("div",{className:"title",children:"mushroom"}),Object(w.jsxs)("div",{className:"login-form",children:[Object(w.jsxs)("div",{className:"form-option",children:[Object(w.jsx)("h4",{children:"\u7528\u6237\u540d"}),Object(w.jsx)("input",{type:"text",id:"name",placeholder:"\u8f93\u5165\u7528\u6237\u540d",required:!0})]}),Object(w.jsxs)("div",{className:"form-option",style:{display:"none"},children:[Object(w.jsx)("h6",{children:"\u623f\u95f4\u53f7"}),Object(w.jsx)("input",{type:"text",id:"num",placeholder:"\u8f93\u5165\u623f\u95f4\u53f7",required:!0})]}),Object(w.jsxs)("div",{className:"form-option radio-option ".concat("oculus"===re?"hiden":""),children:[Object(w.jsx)("span",{children:"\u89c2\u4f17\u8bbf\u95ee\uff1f"}),Object(w.jsx)("input",{type:"radio",id:"auth",name:"auth",value:"true"})]}),Object(w.jsx)("button",{className:"btn",onClick:function(){var t=document.getElementById("name").value,n=document.getElementById("num").value,i="oculus"===re||document.getElementById("auth").checked;e("/room",{state:{username:t,roomid:n,isAudience:i,browserType:re}})},children:"\u8fdb\u5165\u623f\u95f4"}),Object(w.jsxs)("div",{className:"hide",children:[Object(w.jsx)("div",{children:ae()}),Object(w.jsx)("div",{children:"webkitSpeechRecognition ".concat(window.webkitSpeechRecognition?"ok":"no")}),Object(w.jsx)("div",{children:"requestAnimationFrame ".concat(window.requestAnimationFrame?"ok":"no")}),Object(w.jsx)("div",{children:"requestVideoFrameCallback ".concat(document.createElement("video").requestVideoFrameCallback?"ok":"no")})]})]})]}),Object(w.jsxs)("div",{className:"login-img",children:[Object(w.jsxs)("div",{className:"info",children:[Object(w.jsx)("div",{className:"title",children:"mushroom"}),Object(w.jsx)("div",{children:"\u4e09\u7ef4\u89c6\u9891\u4f1a\u8bae\u5ba4"})]}),Object(w.jsx)("img",{src:"/viewfile.png",alt:"#"})]}),Object(w.jsx)("div",{className:"icp",children:Object(w.jsx)("a",{href:"https://beian.miit.gov.cn/",target:"_blank",children:"\u6e58ICP\u59072022006815\u53f7"})})]})};r.a.render(Object(w.jsx)(o.a,{children:Object(w.jsxs)(s.c,{children:[Object(w.jsx)(s.a,{path:"/",element:Object(w.jsx)(oe,{})}),Object(w.jsx)(s.a,{path:"/room",element:Object(w.jsx)(ie,{})})]})}),document.getElementById("root"))}},[[301,1,2]]]);
//# sourceMappingURL=main.5b5f05a2.chunk.js.map