{"version":3,"sources":["modules/Socket/index.ts","modules/eventEmitter.tsx","modules/constant.ts","components/ChatBox/index.tsx","components/Tips/index.tsx","components/ParticipantsList/index.tsx","modules/TEngine/Tlights.ts","modules/TEngine/TEngine.ts","modules/TEngine/TTextures.ts","modules/TEngine/TBasicObject.ts","modules/TEngine/THelper.ts","modules/VoiceControlAPI/VCAPI.ts","modules/RTCEngine/RTCEngine.ts","App.tsx","utils.ts","Login.tsx","index.tsx"],"names":["socket","io","ee","require","CLIENT_USER_EVENT","SERVER_USER_EVENT","SIGNALING_OFFER","SIGNALING_ANSWER","SIGNALING_CANDIDATE","ChatBox","props","useState","sendMsgBySocket","payload","msg","type","emit","JSON","stringify","textBox","newMsgInfo","message","userName","isSelf","timeStamp","diva","document","createElement","divb","classList","add","className","setAttribute","Date","toTimeString","substr","appendChild","innerText","useEffect","msgBox","querySelector","on","now","scrollTop","scrollHeight","receiveNewMsg","console","log","removeAllListeners","name","contentEditable","onClick","inputText","textMsg","value","roomID","viewBox","version","xmlns","width","height","d","fill","Tips","ParticipantsList","participantsList","map","participants","toString","LightsList","ambientLight","AmbientLight","pointLight","PointLight","position","set","spotLight","SpotLight","Math","PI","castShadow","push","TEngine","dom","browserType","renderer","mixer","pmremGenerator","scene","camera","clock","controls","seatsPosition","x","y","z","userVideoBoxes","model","heart","newEnterIndex","stats","this","WebGLRenderer","antialias","Clock","shadowMap","enabled","toneMapping","LinearToneMapping","Scene","PMREMGenerator","compileEquirectangularShader","HemisphereLight","RGBELoader","setDataType","UnsignedByteType","load","texture","envMap","fromEquirectangular","dispose","environment","background","e","PerspectiveCamera","offsetWidth","offsetHeight","setSize","Stats","statsDom","domElement","style","top","right","left","useorbit","OrbitControls","enableDamping","dampingFactor","screenSpacePanning","target","Vector3","maxPolarAngle","minPolarAngle","update","FirstPersonControls","lookSpeed","movementSpeed","constrainVertical","verticalMin","verticalMax","object","lookAt","up","onWindowResize","aspect","window","innerWidth","innerHeight","updateProjectionMatrix","addEventListener","setAnimationLoop","getDelta","render","TWEEN","updateUserVideoRotation","VRButton","createButton","cb","loader","GLTFLoader","gltf","traverse","isMesh","frustumCulled","material","emissive","color","emissiveMap","receiveShadow","scale","ObjectLoader","obj","forEach","elem","vb","index","cameraPosition","clone","videoPostion","rotY","atan","rotation","url","userVideo","geometry","PlaneGeometry","VideoTexture","format","RGBAFormat","MeshBasicMaterial","transparent","side","DoubleSide","needsUpdate","box","Mesh","videoName","filter","b","remove","toneMappingExposure","mid","t","points","tweens","point","arr","length","to","onUpdate","p","pop","i","chain","animate","QuadraticBezierCurve3","getPoints","start","textureLoader","TextureLoader","stageTexture","wrapS","RepeatWrapping","wrapT","repeat","wallTexture","basicObjectList","BoxBufferGeometry","MeshStandardMaterial","stage","metalness","roughness","PlaneBufferGeometry","rightWall","rotateY","southWall","helperList","axesHelper","AxesHelper","GridHelper","PointLightHelper","distance","SpotLightHelper","webkitSpeechRecognition","VCAPI","recognition","listenedEvent","stop","bindListening","keyword","callback","continuous","lang","interimResults","last_ten_words","find","onresult","resultIndex","str","results","transcript","len","some","indexOf","setTimeout","RTCEngine","peerList","videoList","local_video","is_audience","onnewuserenterroom","onnewvideoloaded","onuserleaveroom","data","parse","initRTC","onlineUsers","leaveName","a","handleReceiveOffer","handleReceiveAnswer","handleReceiveCandidate","onlineUser","rtcUserName","pc","createPeerConnection","mediaStream","srcObject","getTracks","track","addTrack","user_name","room_id","video","loginName","remoteUserName","RTCPeerConnection","username","credential","onnegotiationneeded","createOffer","offer","setLocalDescription","sendRTCEvent","from","sdp","localDescription","onicecandidate","evt","candidate","ontrack","remoteVideo","streams","muted","autoplay","playsInline","play","video_name","remoteDescription","remoteUser","setRemoteDescription","createAnswer","answer","signalingState","addIceCandidate","App","location","useLocation","state","isAudience","sceneList","setParticipantsList","curScene","setCurScene","createLocalVideo","humanseg","navigator","mediaDevices","getUserMedia","audio","mediastream","w","getVideoTracks","getSettings","h","hc","mc","bc","segment_video","captureStream","segment","onloadeddata","humanCanvas","maskCanvas","backgroundCanvas","cutout","requestAnimationFrame","client","u","Promise","resolve","reject","display","onclick","undefined","login","threeTarget","TE","loadRoom","addObject","loadLove","startLove","changeScene","adjustBrightness","removeUserVideo","resultVideo","v","rv","displayCanvasEl","gl","getContext","vs","createShader","VERTEX_SHADER","shaderSource","compileShader","fs","FRAGMENT_SHADER","getElementById","prog","createProgram","attachShader","linkProgram","useProgram","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","coordLoc","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","activeTexture","TEXTURE0","tex","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","texLoc","getUniformLocation","texWidthLoc","texHeightLoc","requestVideoFrameCallback","processFrame","metadata","viewport","texImage2D","RGB","UNSIGNED_BYTE","uniform1i","uniform1f","drawArrays","TRIANGLE_FAN","cleanGreen","addUserVideo","keyCode","disableControls","enableControls","VC","Object","keys","key","selected","contains","chatBoxDom","addSpace","listDom","BrowserType","ua","userAgent","toLowerCase","testUa","regexp","test","system","Login","useNavigate","id","placeholder","required","roomid","checked","src","alt","ReactDOM","path","element"],"mappings":"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","file":"static/js/main.da4296ee.chunk.js","sourcesContent":["import { io } from \"socket.io-client\"\nconst socket = io(\"https://www.dramalf.xyz\")\n// const socket = io(\"http://localhost:8080\")\nexport default socket","const eventEmmiter = require('eventemitter3')\nconst ee = new eventEmmiter()\nexport default ee","export const CLIENT_RTC_EVENT = 'CLIENT_RTC_EVENT';\nexport const SERVER_RTC_EVENT = 'SERVER_RTC_EVENT';\n\nexport const CLIENT_USER_EVENT = 'CLIENT_USER_EVENT';\nexport const SERVER_USER_EVENT = 'SERVER_USER_EVENT';\n\nexport const CLIENT_USER_EVENT_LOGIN = 'CLIENT_USER_EVENT_LOGIN'; // 登录\n\nexport const SERVER_USER_EVENT_UPDATE_USERS = 'SERVER_USER_EVENT_UPDATE_USERS';\n\nexport const CLIENT_USER_EVENT_SEND_MESSAGE=\"CLIENT_USER_EVENT_SEND_MESSAGE\"\nexport const SERVER_USER_EVENT_BROADCAST_MESSAGE= 'SERVER_USER_EVENT_BROADCAST_MESSAGE';\n\nexport const SIGNALING_OFFER = 'SIGNALING_OFFER';\nexport const SIGNALING_ANSWER = 'SIGNALING_ANSWER';\nexport const SIGNALING_CANDIDATE = 'SIGNALING_CANDIDATE';\n\n","import React, { useEffect,useState } from 'react'\nimport socket from '../../modules/Socket'\nimport TextMsgBox from './TextMsgBox'\nimport \"./index.css\"\nimport {\n    CLIENT_RTC_EVENT,\n    SERVER_RTC_EVENT,\n\n    CLIENT_USER_EVENT,\n    SERVER_USER_EVENT,\n    CLIENT_USER_EVENT_LOGIN,\n    SERVER_USER_EVENT_UPDATE_USERS,\n    CLIENT_USER_EVENT_SEND_MESSAGE,\n    SERVER_USER_EVENT_BROADCAST_MESSAGE,\n    SIGNALING_OFFER,\n    SIGNALING_ANSWER,\n    SIGNALING_CANDIDATE,\n} from '../../modules/constant'\ninterface ChatBoxProps {\n    userName: String\n}\nexport default function ChatBox(props: ChatBoxProps) {\n\n    const [msg_history,update_msg_history]=useState<any>([])\n\n    function sendUserEvent(msg: any) {\n        socket.emit(CLIENT_USER_EVENT, JSON.stringify(msg));\n    }\n\n    interface UserMsg {\n        userName: String,\n        message: String,\n        roomID: any\n    }\n    function sendMsgBySocket(payload: UserMsg) {\n        sendUserEvent({\n            type: CLIENT_USER_EVENT_SEND_MESSAGE,\n            payload\n        });\n    }\n\n\n    useEffect(() => {\n        const msgBox: HTMLElement | null = document.querySelector(\".chat-record-panel\")\n        function receiveNewMsg(payload:UserMsg) {\n            const {userName,message}=payload;\n            const newMsgInfo={\n                userName,\n                message,\n                isSelf:false,\n                timeStamp:Date.now()\n            };\n            (msgBox as HTMLElement).appendChild(textBox(newMsgInfo));\n            //update_msg_history([...msg_history,newMsgInfo]);\n             //(msgBox as HTMLElement).appendChild(msgBubbles(userName, message, false));\n             (msgBox as HTMLElement).scrollTop=(msgBox as HTMLElement).scrollHeight\n        }\n        socket.on(SERVER_USER_EVENT,(msg)=>{\n            const {type,payload}=msg\n            if(type===SERVER_USER_EVENT_BROADCAST_MESSAGE){\n                receiveNewMsg(payload)\n                console.log('revieve new msg')\n            }\n        })\n        return () => {\n            socket.removeAllListeners()\n      \n          }\n    },[])\n    function textBox(newMsgInfo:any){\n        const {\n            message,\n            userName,\n            isSelf,\n            timeStamp\n        }=newMsgInfo\n        let diva=document.createElement('div');\n        let divb=document.createElement('div');\n        diva.classList.add('msg-wrapper');\n       \n        divb.className=`message ${isSelf?'my-message':'other-message'}`;\n        divb.setAttribute('data-username',isSelf?'':userName);\n        divb.setAttribute('data-time',new Date(timeStamp).toTimeString().substr(0, 8));\n        diva.appendChild(divb);\n        divb.innerText=message;\n        return diva;\n\n    }\n    function sendTextMsg() {\n        const msgBox: HTMLElement | null = document.querySelector(\".chat-record-panel\")\n        const inputText: HTMLTextAreaElement | null = document.querySelector(\".input-panel textarea\")\n        const textMsg = (inputText as HTMLTextAreaElement).value\n        let roomId = 100\n\n        if (textMsg) {\n            //socket.emit(\"sendNewMsg\", textMsg, roomId);\n            const payload = {\n                userName: props.userName,\n                message: textMsg,\n                roomID: roomId\n            }\n            sendMsgBySocket(payload);\n            const newMsgInfo={\n                userName:props.userName,\n                message:textMsg,\n                isSelf:true,\n                timeStamp:Date.now()\n            };\n         \n            //update_msg_history([...msg_history,newMsgInfo]);\n             (msgBox as HTMLElement).appendChild(textBox(newMsgInfo));\n          \n            // (msgBox as HTMLElement).appendChild(msgBubbles(props.userName, textMsg, true) as unknown as Node);\n            (msgBox as HTMLElement).scrollTop=(msgBox as HTMLElement).scrollHeight;\n            (inputText as HTMLTextAreaElement).value = \"\"\n        }\n    }\n\n    return (\n        <div className=\"chat-box-wrapper\">\n            <div className=\"chat-record-panel\">\n                <h4>聊天</h4>\n              \n            </div>\n            <div className=\"send-msg-part\">\n                <div className=\"input-panel\">\n                    <textarea name=\"comment\" contentEditable={true} data-text=\"输入内容...\">\n                    </textarea>\n                </div>\n                <div className=\"send-msg-btn\" onClick={sendTextMsg}>\n                <svg  className=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2268\" width=\"200\" height=\"200\"><path d=\"M392.021333 925.013333a34.133333 34.133333 0 0 1-34.133333-34.133333V579.242667c0-10.24 4.608-19.968 12.629333-26.453334l276.48-224.085333a34.0992 34.0992 0 0 1 43.008 52.906667L426.154667 595.456v192.853333l82.944-110.592c10.069333-13.482667 28.672-17.578667 43.52-9.557333l137.557333 73.728L853.333333 156.16c3.242667-11.434667-3.413333-18.602667-6.485333-21.162667-3.072-2.56-11.093333-7.850667-21.845333-2.901333L206.336 422.4l80.213333 46.08c16.384 9.386667 22.016 30.208 12.629334 46.592s-30.208 22.016-46.592 12.629333l-137.045334-78.677333a33.979733 33.979733 0 0 1-17.066666-31.061333c0.512-12.8 8.021333-24.064 19.626666-29.525334L795.989333 70.314667c31.744-14.848 68.096-10.069333 94.890667 12.629333a87.790933 87.790933 0 0 1 28.16 91.477333L744.277333 801.28a34.082133 34.082133 0 0 1-48.981333 20.821333L546.133333 742.058667l-126.805333 169.301333c-6.656 8.704-16.896 13.653333-27.306667 13.653333z\" p-id=\"2269\" fill=\"#e6e6e6\"></path></svg>                </div>\n               \n            </div>\n        </div>\n    )\n}\n","import React from 'react'\nimport './index.css'\nfunction Tips(props:any) {\n    return (\n        <div className='tips-wrapper'>\n            <div className='tips-box'>\n                <h4>提示</h4>\n                <div\n                    className='info-box'> <div>会议期间会使用到您的摄像头或麦克风</div>\n                    <div>观众可以选择VR模式旁听会议</div>\n                    <div>声控和手势识别功能可根据个人需要和设备性能选择开启</div>\n                </div>\n                <div className='tips-enter-btn'>\n                    进入会议\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default Tips","import React from 'react'\nimport './index.css'\ninterface Iprops {\n    participantsList:Array<String>\n}\nexport default function ParticipantsList(props:Iprops) {\n    return (\n        <div className='user-list-wrapper'>\n            <h4>与会列表</h4>\n            <div className='user-list-box'>\n            {props.participantsList.map(participants=>{\n                return <div key={participants.toString()} data-name={participants}>{participants}</div>\n            })}\n            </div>\n          \n        </div>\n    )\n}\n","import {\n  AmbientLight,\n  Object3D,\n  PointLight,\n  SpotLight\n} from 'three'\n\nexport const LightsList: Object3D[] = []\n\nexport const ambientLight: AmbientLight = new AmbientLight('rgb(64,64,64)',0.2)\n\nexport const pointLight: PointLight = new PointLight(\n  'rgb(240, 225, 240)',\n  1\n)\n\npointLight.position.set(0, 20, 0)\n\nexport const spotLight: SpotLight = new SpotLight(\n  'rgb(255, 255, 255)',\n  1,\n  200,\n  Math.PI ,\n  0,\n  0\n)\n\nspotLight.castShadow = true\n\nspotLight.position.set(0, 200, 0)\n\n\n\nLightsList.push(spotLight,pointLight)","import {\n  AmbientLight,\n  AxesHelper,\n  BoxBufferGeometry,\n  GridHelper,\n  RGBAFormat,\n  TextureLoader,\n  ObjectLoader,\n  DoubleSide,\n  Mesh,\n  MeshStandardMaterial,\n  PerspectiveCamera,\n  Scene,\n  Vector3,\n  WebGLRenderer,\n  MOUSE,\n  Object3D,\n  Group,\n  Clock,\n  Raycaster,\n  TetrahedronBufferGeometry,\n  VideoTexture,\n  PMREMGenerator,\n  UnsignedByteType,\n  HemisphereLight,\n  CanvasTexture,\n  AnimationMixer,\n  MeshBasicMaterial,\n  PlaneGeometry,\n  CineonToneMapping,\n  LinearToneMapping,\n  QuadraticBezierCurve3\n} from \"three\"\nimport * as TWEEN from '@tweenjs/tween.js'\nimport Stats from 'three/examples/jsm/libs/stats.module'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'\nimport { FirstPersonControls } from 'three/examples/jsm/controls/FirstPersonControls'\nimport { PointerLockControls } from 'three/examples/jsm/controls/PointerLockControls'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader';\nimport { FaceMeshFaceGeometry } from \"./js/face.js\";\nimport { ambientLight } from './Tlights'\nimport { VRButton } from 'three/examples/jsm/webxr/VRButton.js';\n\nexport class TEngine {\n\n  private dom: HTMLElement\n  public renderer: WebGLRenderer\n  private mixer: AnimationMixer | undefined\n  private pmremGenerator: PMREMGenerator\n  private scene: Scene\n  private camera: PerspectiveCamera\n  private ambientLight: AmbientLight\n  private clock: Clock\n  private controls: FirstPersonControls | OrbitControls\n  private seatsPosition = [{\n    x: -38,\n    y: 29,\n    z: 0\n  }, {\n    x: -20,\n    y: 29,\n    z: -20\n  }, {\n    x: 0,\n    y: 29,\n    z: -20\n  }, {\n    x: 26,\n    y: 29,\n    z: -20\n  }, {\n    x: 38,\n    y: 29,\n    z: 0\n  }, {\n    x: 26,\n    y: 29,\n    z: 20\n  }, {\n    x: 0,\n    y: 29,\n    z: 20\n  }, {\n    x: -20,\n    y: 29,\n    z: 20\n  },\n\n  ]\n\n  private userVideoBoxes: Array<{ object: any, videoName: any }> = []\n  private model!: Group\n  private heart!: Group\n  private newEnterIndex = 0\n  stats: Stats\n  constructor(dom: HTMLElement, enableVR = false, browserType: string) {\n    this.dom = dom\n    this.renderer = new WebGLRenderer({\n      antialias: true\n    })\n    this.clock = new Clock()\n    this.renderer.shadowMap.enabled = true;\n    this.renderer.toneMapping = LinearToneMapping\n    this.ambientLight = ambientLight;\n    this.scene = new Scene()\n    this.scene.add(this.ambientLight);\n    const pmremGenerator = new PMREMGenerator(this.renderer); // 使用hdr作为背景色\n    pmremGenerator.compileEquirectangularShader();\n    this.pmremGenerator = pmremGenerator;\n    const scene = this.scene;\n    const light = new HemisphereLight(0xffffbb, 0x000020, 1);\n\n    new RGBELoader()\n      .setDataType(UnsignedByteType)\n      .load('/texture/autumn_forest_04_1k.hdr', function (texture) {\n        const envMap = pmremGenerator.fromEquirectangular(texture).texture;\n        // envMap.isPmremTexture = true;\n        pmremGenerator.dispose();\n        console.log('here');\n        scene.environment = envMap; // 给场景添加环境光效果\n        scene.background = envMap; // 给场景添加背景图\n      }, () => { }, (e) => { console.log('error in load env_texture', e); });\n\n    this.camera = new PerspectiveCamera(60, dom.offsetWidth / dom.offsetHeight, 1, 1000)\n\n\n\n    this.renderer.setSize(dom.offsetWidth, dom.offsetHeight, true)\n\n    // 初始性能监视器\n    const stats = Stats()\n    const statsDom = stats.domElement\n    this.stats = stats;\n    statsDom.style.position = 'fixed'\n    statsDom.style.top = '0'\n    statsDom.style.right = '5px'\n    statsDom.style.left = 'unset'\n\n\n\n    let controls;\n    let useorbit = browserType === 'oculus' || browserType === 'android' || browserType === 'ios'\n    if (useorbit) {\n      controls = new OrbitControls(this.camera, this.dom);\n      controls.enableDamping = true;\n      controls.dampingFactor = 0.05;\n      controls.screenSpacePanning = false;\n      controls.target = new Vector3(0, 28, 0)\n      controls.maxPolarAngle = Math.PI / 2 + 0.001;\n      controls.minPolarAngle = Math.PI / 2;\n      controls.update()\n    } else {\n      controls = new FirstPersonControls(this.camera, this.dom);\n      controls.lookSpeed = 0.2; //鼠标移动查看的速度\n      controls.movementSpeed = 20; //相机移动速度\n      // controls.noFly = true;\n      controls.constrainVertical = true; //约束垂直\n      controls.verticalMin = Math.PI / 2;\n\n      controls.verticalMax = Math.PI / 2 + 0.0000001;\n    }\n\n    this.controls = controls\n\n    this.controls.object.position.set(-38, 28, 0)\n    this.controls.object.lookAt(new Vector3(0, 0, 0))\n\n    this.camera.up = new Vector3(0, 1, 0)\n    //@ts-ignore\n    useorbit && this.controls.update();\n   \n\n    const onWindowResize = () => {\n\n      this.camera.aspect = window.innerWidth / window.innerHeight;\n      this.camera.updateProjectionMatrix();\n\n      this.renderer.setSize(dom.offsetWidth, dom.offsetHeight, true);\n\n    }\n    window.addEventListener('resize', onWindowResize);\n\n    //     const renderFun = () => {\n    // //@ts-ignore\n    //       this.controls.update(this.clock.getDelta())\n    //       this.renderer.render(this.scene, this.camera)\n    //       stats.update()\n    //       TWEEN.update();\n    //      updateUserVideoRotation()\n    //       requestAnimationFrame(renderFun)\n    //     }\n    //this.renderid=requestAnimationFrame(this.renderFun);\n\n    this.renderer.setAnimationLoop(() => {\n      !useorbit&&this.controls.update(this.clock.getDelta())\n      useorbit&&(this.controls as OrbitControls).update()\n      this.renderer.render(this.scene, this.camera)\n      stats.update()\n      TWEEN.update();\n      this.updateUserVideoRotation()\n    })\n\n\n\n    dom.appendChild(this.renderer.domElement)\n    dom.appendChild(statsDom)\n    dom.appendChild( VRButton.createButton( this.renderer ) )\n  }\n\n  loadRoom(cb = () => { }) {\n    //载入模型\n    const loader: GLTFLoader = new GLTFLoader()\n\n    loader.load('/models/table/scene.gltf', (gltf) => {\n\n      // this.mixer= new AnimationMixer(gltf.scene)\n      // var action=this.mixer.clipAction(gltf.animations[0])\n      // // action.timeScale=0.8\n      // action.time=4\n      gltf.scene.traverse((object) => {\n        if ((object as Mesh).isMesh) {\n          // 修改模型的材质\n          object.castShadow = true;\n          object.frustumCulled = false;\n          // object.receiveShadow = true;\n\n          (object as any).material.emissive = (object as any).material.color;\n          (object as any).material.emissiveMap = (object as any).material.map;\n        }\n      })\n      gltf.scene.receiveShadow = true\n      this.model = gltf.scene\n      this.scene.add(gltf.scene)\n      gltf.scene.position.set(0, 0, 0)\n      gltf.scene.scale.set(0.3, 0.3, 0.3)\n      cb();\n    }, () => { }, (e) => { console.log(\"error\", e) })\n\n  }\n\n  load_sprite() {\n    const loader = new ObjectLoader()\n    console.log('120')\n    loader.load('/models/sprite/sprite.json', (obj) => {\n      this.scene.add(obj)\n      obj.position.set(-29, 30, -20)\n      obj.scale.set(10, 10, 10)\n      console.log(obj, 120)\n      // this.mixer= new AnimationMixer(gltf.scene)\n      // var action=this.mixer.clipAction(gltf.animations[0])\n      // // action.timeScale=0.8\n      // action.time=4\n\n    }, () => { }, (e) => { console.log(\"error\", e) })\n\n  }\n  addObject(...object: Object3D[]) {\n    object.forEach(elem => {\n      this.scene.add(elem)\n    })\n  }\n  updateUserVideoRotation() {\n\n    this.userVideoBoxes.map((vb, index) => {\n      if (!vb) return\n      const { object } = vb\n      const cameraPosition = this.camera.position.clone()\n\n      const videoPostion = object.position.clone()\n      //const rotY=-Math.atan(lookAtPosition.x/lookAtPosition.z)-Math.PI/2\n      const rotY = Math.atan((videoPostion.x - cameraPosition.x) / (videoPostion.z - cameraPosition.z))\n\n      object.rotation.y = rotY\n\n    })\n  }\n\n  changeScene(url: string) {\n    new RGBELoader()\n      .setDataType(UnsignedByteType)\n      .load(`/texture/${url}.hdr`, (texture) => {\n        const envMap = this.pmremGenerator.fromEquirectangular(texture).texture;\n        // envMap.isPmremTexture = true;\n        this.pmremGenerator.dispose();\n        this.scene.environment = envMap; // 给场景添加环境光效果\n        this.scene.background = envMap; // 给场景添加背景图\n      }, () => { }, (e) => { console.log('123,', e); });\n\n  }\n  addUserVideo(userVideo: HTMLVideoElement, userName: string) {\n    var geometry = new PlaneGeometry(48, 36, 96, 72);\n    const texture = new VideoTexture(userVideo);\n    texture.format = RGBAFormat;\n    const material = new MeshBasicMaterial({\n      map: texture,\n      transparent: true,\n      side: DoubleSide\n    })\n    material.needsUpdate = true\n    const box = new Mesh(geometry, material)\n\n    const { x, y, z } = this.seatsPosition[this.newEnterIndex]\n    this.newEnterIndex++;\n    box.position.set(x, y, z)\n\n    box.scale.set(0.4, 0.4, 0.4)\n    //box.rotateY(-Math.PI/3)\n\n    //let cameraPosition=this.camera.position.clone()\n    this.userVideoBoxes.push({\n      object: box,\n      videoName: userName\n    })\n    this.scene.add(box);\n  }\n  removeUserVideo(userName: string) {\n    this.userVideoBoxes = this.userVideoBoxes.filter(b => {\n      if (b.videoName === userName) {\n        console.log('997', b);\n        b.object.material.dispose();\n        b.object.geometry.dispose();\n        this.scene.remove(b.object);\n\n      }\n      return b.videoName !== userName\n    })\n  }\n  adjustBrightness(type: string) {\n    if (type === 'brighter') {\n      console.log('亮一点')\n      this.renderer.toneMappingExposure += 0.1\n    } else {\n      console.log('暗一点')\n      this.renderer.toneMappingExposure -= 0.1\n    }\n  }\n\n  startLove() {\n    const heart = this.heart.clone();\n    this.scene.add(heart)\n\n    const position = new Vector3(-20, 24, -18);\n    const mid = new Vector3(-32, 36, -10);\n    const target = new Vector3(-38, 24, 0);\n    const curve = new QuadraticBezierCurve3(\n      position,\n      mid,\n      target\n    )\n    const points = curve.getPoints(50);\n    function animate(points: Vector3[]) {\n      let i = 0;\n      let tween1;\n      let tweens = points.map((point, index, arr) => {\n        if (index < points.length - 2) {\n          let t = new TWEEN.Tween(point).to(arr[index + 1], 10);\n          t.onUpdate((p) => {\n            heart.position.set(p.x, p.y, p.z);\n          })\n          return t\n        }\n\n      });\n\n      tweens.pop()\n      console.log(tweens, 998)\n      for (let i = 0; i < points.length - 1; i++) {\n        if (tweens[i + 1] && tweens[i])\n          //@ts-ignore\n          tweens[i].chain(tweens[i + 1] as TWEEN.Tween<Vector3>)\n      }\n      //@ts-ignore\n      return tweens[0]\n    }\n    let t = animate(points);\n\n    t?.start()\n    // var tween = new TWEEN.Tween(position).to(target);\n    // tween.easing(TWEEN.Easing.Elastic.InOut)\n    // let i=0;\n    // tween.onUpdate(()=>{\n    // console.log('up')  ;\n    // i++;\n    // let p=points[i%49]\n    //   heart.position.set(p.x,p.y,p.z);\n    // })\n    // tween.start()\n\n    // for ( let i = 0; i < 200; i ++ ) {\n\n    //   const object = heart.clone();\n\n    //   object.position.x = Math.random() * 40 -20;\n    //   object.position.y = Math.random() * 20+20;\n    //   object.position.z = Math.random() * 30 -10;\n\n    //   object.userData.velocity = new Vector3();\n    //   object.userData.velocity.x = Math.random() * 0.01 - 0.005;\n    //   object.userData.velocity.y = Math.random() * 0.01 - 0.005;\n    //   object.userData.velocity.z = Math.random() * 0.01 - 0.005;\n\n    //   this.scene.add( object );\n\n    // }\n  }\n  loadLove() {\n    const loader: GLTFLoader = new GLTFLoader()\n\n    loader.load('/models/heart_in_love/scene.gltf', (gltf) => {\n\n      // this.mixer= new AnimationMixer(gltf.scene)\n      // var action=this.mixer.clipAction(gltf.animations[0])\n      // // action.timeScale=0.8\n      // action.time=4\n      gltf.scene.traverse((object) => {\n        if ((object as Mesh).isMesh) {\n          // 修改模型的材质\n          object.castShadow = true;\n          object.frustumCulled = false;\n          // object.receiveShadow = true;\n\n          (object as any).material.emissive = (object as any).material.color;\n          (object as any).material.emissiveMap = (object as any).material.map;\n        }\n      })\n      gltf.scene.receiveShadow = true\n      this.heart = gltf.scene\n      // this.scene.add(gltf.scene)\n      // gltf.scene.position.set(30, 30, 30)\n      gltf.scene.scale.set(0.01, 0.01, 0.01)\n    }, () => { }, (e) => { console.log(\"error\", e) })\n  }\n\n  disableControls() {\n    this.controls.enabled = false\n  }\n  enableControls() {\n    this.controls.enabled = true\n  }\n}\n","import { Texture, TextureLoader,RepeatWrapping } from \"three\";\n\nconst textureLoader: TextureLoader = new TextureLoader()\n\nexport const stageTexture: Texture = textureLoader.load('./texture/wood.jpeg')\nstageTexture.wrapS = RepeatWrapping;\nstageTexture.wrapT = RepeatWrapping;\nstageTexture.repeat.set( 10, 4 );\n\nexport const wallTexture: Texture = textureLoader.load('./texture/wall2.jpg')\nwallTexture.wrapS = RepeatWrapping;\nwallTexture.wrapT = RepeatWrapping;\nwallTexture.repeat.set( 10, 4 );","import {\n  Mesh,\n  BoxBufferGeometry,\n  MeshStandardMaterial,\n  SphereBufferGeometry,\n  CylinderBufferGeometry,\n  Object3D,\n  Line,\n  Points,\n  PointsMaterial,\n  Material,\n  PlaneBufferGeometry,\n  DoubleSide,\n  CircleBufferGeometry\n} from 'three'\nimport { stageTexture,wallTexture } from './TTextures'\n\nexport const basicObjectList: Object3D[] = []\nexport const body:Mesh=new Mesh(\n  new BoxBufferGeometry(10, 20, 10),\n  new MeshStandardMaterial({\n    map:stageTexture\n  })\n);\nbody.position.x=0;\n// 地面\nconst stage: Mesh = new Mesh(\n  new BoxBufferGeometry(200, 10, 200),\n  new MeshStandardMaterial({\n    map:stageTexture\n  })\n)\n\nstage.castShadow = true\nstage.receiveShadow = true\n\nstage.position.y = -5\n\n// 立方体\nconst box: Mesh = new Mesh(\n  new BoxBufferGeometry(2, 10, 2),\n  new MeshStandardMaterial({\n    color: '#b57355',\n    metalness:0.5,\n    roughness: 0.3\n  })\n)\n\nbox.castShadow = true\nbox.receiveShadow = true\n\nbox.position.set(-10,5,-10)\n\n\n//墙壁\nconst leftWall:Mesh=new Mesh(\n  new PlaneBufferGeometry(100, 40),\n  new MeshStandardMaterial({\n    map:wallTexture,\n    side:DoubleSide\n  })\n)\nleftWall.position.set(0,20,-50)\n\nconst rightWall:Mesh=new Mesh(\n  new PlaneBufferGeometry(100, 40),\n  new MeshStandardMaterial({\n   map:wallTexture,\n   side:DoubleSide\n  })\n)\nrightWall.rotateY(Math.PI/2)\nrightWall.position.set(-50,20,0)\n\nconst southWall:Mesh=new Mesh(\n  new PlaneBufferGeometry(100, 40),\n  new MeshStandardMaterial({\n   map:wallTexture,\n   side:DoubleSide\n  })\n)\nsouthWall.rotateY(Math.PI/2)\nsouthWall.position.set(50,20,0)\n\nconst eastWall:Mesh=new Mesh(\n  new PlaneBufferGeometry(100, 40),\n  new MeshStandardMaterial({\n   map:wallTexture,\n   side:DoubleSide\n  })\n)\n\neastWall.position.set(0,20,50)\n\n\nbasicObjectList.push(stage)","import {\n  AxesHelper,\n  GridHelper,\n  Object3D,\n  PointLightHelper,\n  SpotLightHelper\n} from 'three'\n\nimport { pointLight, spotLight } from './Tlights'\n\nexport const helperList: Object3D[] = []\n\nconst axesHelper: AxesHelper = new AxesHelper(500)\nconst gridHelper: GridHelper = new GridHelper(500, 20, 'rgb(200, 200, 200)', 'rgb(100, 100, 100)')\n\n\nconst pointLightHelper: PointLightHelper = new PointLightHelper(pointLight, pointLight.distance, pointLight.color)\n\nconst spotLightHelper: SpotLightHelper = new SpotLightHelper(spotLight, spotLight.color)\n\n  helperList.push(axesHelper)","\ninterface IWindow extends Window {\n    webkitSpeechRecognition: any;\n}\ninterface VCEvent {\n    keyword: string,\n    callback: Function\n}\nconst { webkitSpeechRecognition }: IWindow = <IWindow><unknown>window;\nexport class VCAPI {\n    private recognition = new webkitSpeechRecognition();\n    private listenedEvent: Array<VCEvent> = [];\n    constructor() {\n        this.recognition.continuous = true;\n        this.recognition.lang = 'cmn-Hans-CN'; //普通话 (中国大陆)\n        this.recognition.interimResults = true;\n        let last_ten_words = '';\n        let find = false;\n        this.recognition.onresult = (e: any) => {\n            let resultIndex = e.resultIndex\n            let str = e.results[resultIndex][0].transcript\n            console.log(str)\n            if (!str.length||find) return\n            let len = str.length\n            last_ten_words = str.substr(len - 10 ? len - 10 : 0, len - 10 ? 10 : len)\n            this.listenedEvent.some(e => {\n                const { keyword, callback } = e;\n                let start = last_ten_words.indexOf(keyword);//获得字符串的开始位置\n\n                if (start >= 0) {\n                    find=true;\n                    setTimeout(() => {\n                        find=false\n                    }, 2000);\n                    callback()\n                }\n            })\n            //console.log(e)\n        }\n    }\n    stop = () => {\n        this.recognition.stop()\n    }\n    start = () => {\n        this.recognition.start()\n    }\n    bindListening = (keyword: string, callback: Function) => {\n        this.listenedEvent.push({\n            keyword,\n            callback\n        })\n    }\n}","// import {\n//   sendRTCEvent,\n//   sendUserEvent\n// } from './RTCUtils'\n// import socket from \"../Socket/index\"\n// import ee from '../eventEmitter'\nimport {\n  CLIENT_RTC_EVENT,\n  SERVER_RTC_EVENT,\n\n  CLIENT_USER_EVENT,\n  SERVER_USER_EVENT,\n  CLIENT_USER_EVENT_LOGIN,\n  SERVER_USER_EVENT_UPDATE_USERS,\n  CLIENT_USER_EVENT_SEND_MESSAGE,\n  SIGNALING_OFFER,\n  SIGNALING_ANSWER,\n  SIGNALING_CANDIDATE,\n} from '../constant'\nimport { Socket } from 'socket.io-client'\n\ninterface onlineUserT {\n  userName: String,\n  roomID: any\n}\nexport class RTCEngine {\n  private peerList:any={}\n  private videoList:any={}\n  private userName?: string \n  private local_video!: HTMLVideoElement\n  private is_audience: Boolean = false\n  private socket!: Socket\n  private ee: any\n  public onnewuserenterroom: any\n  public onnewvideoloaded:any\n  public onuserleaveroom:any\n  constructor(socket: Socket, ee: any) {\n    // this.userName = userName;\n    this.ee = ee;\n    this.socket = socket;\n    // this.is_audience = is_audience;\n    // this.local_video = local_video;\n    socket.on(\"FIRSTASKLIST\", (payload) => {\n      console.log('User first time get all online users list')\n      let data = JSON.parse(payload)\n      this.onnewuserenterroom && this.onnewuserenterroom(data);\n      this.initRTC(data.onlineUsers)\n    })\n    socket.on('user_leave',(leaveName:string)=>{\n      console.log('in rtc ')\n      this.onuserleaveroom&&this.onuserleaveroom(leaveName)\n    })\n    socket.on(SERVER_USER_EVENT, (msg) => {\n      const { type, payload } = msg\n      switch (type) {\n        case SERVER_USER_EVENT_UPDATE_USERS:\n          this.onnewuserenterroom && this.onnewuserenterroom(payload);\n          break;\n      }\n    })\n    socket.on(SERVER_RTC_EVENT, async (msg) => {\n      const { type } = msg;\n      switch (type) {\n        case SIGNALING_OFFER:\n          this.handleReceiveOffer(msg);\n          break;\n        case SIGNALING_ANSWER:\n          await this.handleReceiveAnswer(msg);\n          break;\n        case SIGNALING_CANDIDATE:\n          await this.handleReceiveCandidate(msg);\n          break;\n      }\n    });\n  }\n  private async initRTC(onlineUsers: Array<onlineUserT>) {\n    const localVideo = this.local_video\n    const is_audience = this.is_audience;\n    if (onlineUsers.length > 1) {\n\n      onlineUsers.forEach((onlineUser: { userName: any; }) => {\n        const { userName: rtcUserName } = onlineUser\n        if (!this.peerList[rtcUserName] && rtcUserName !== this.userName) {\n\n          let pc: RTCPeerConnection = this.createPeerConnection(rtcUserName)\n          this.peerList[rtcUserName] = pc\n          if (!is_audience) {\n            const mediaStream = this.local_video.srcObject as MediaStream\n            mediaStream.getTracks().forEach(track => {\n              pc.addTrack(track, mediaStream);\n            });\n          }\n\n        }\n      })\n\n    }\n\n  }\n\n  login(user_name: string, room_id: string, video?: HTMLVideoElement) {\n    if (video) {\n      this.is_audience = false;\n      this.local_video = video;\n    } else {\n      this.is_audience = true\n    }\n    this.userName=user_name\n    const msg = {\n      type: CLIENT_USER_EVENT_LOGIN,\n      payload: {\n        loginName: user_name,\n        roomID: 100\n      }\n    }\n    this.socket.emit(CLIENT_USER_EVENT, JSON.stringify(msg));\n  }\n  private createPeerConnection(remoteUserName: string) {\n    const { userName } = this\n    const iceConfig = {\n      \"iceServers\": [\n        { url: 'stun:stun.ekiga.net' },\n        { url: 'turn:turnserver.com', username: 'user', credential: 'pass' }\n      ]\n    } as unknown as RTCConfiguration\n\n    let pc: RTCPeerConnection = new RTCPeerConnection(iceConfig);\n\n\n    const onnegotiationneeded=async (e: any)=>{\n\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer); // TODO 错误处理\n\n      this.sendRTCEvent({\n        type: SIGNALING_OFFER,\n        payload: {\n          from: userName,\n          target: remoteUserName,\n          sdp: pc.localDescription // TODO 直接用offer？\n        }\n      });\n    }\n    const onicecandidate=async (evt: any)=> {\n      if (evt.candidate) {\n        //log(`onicecandidate.`);\n\n       this.sendRTCEvent({\n          type: SIGNALING_CANDIDATE,\n          payload: {\n            from: userName,\n            target: remoteUserName,\n            candidate: evt.candidate\n          }\n        });\n      }\n    }\n\n\n    const ontrack=(evt: any)=>{\n      let remoteVideo: HTMLVideoElement | null = this.videoList[remoteUserName]\n\n      if (remoteVideo) {\n        if (remoteVideo.srcObject) return\n        remoteVideo.srcObject = evt.streams[0];\n      } else {\n        remoteVideo = document.createElement('video');\n        remoteVideo.srcObject = evt.streams[0];\n        remoteVideo.muted = true;\n        remoteVideo.autoplay = true;\n        remoteVideo.playsInline = true;\n        remoteVideo.width = 640;\n        remoteVideo.height = 480;\n        this.videoList[remoteUserName]=remoteVideo;\n        remoteVideo.play()\n        this.onnewvideoloaded&&this.onnewvideoloaded({\n          video:remoteVideo,\n          video_name:remoteUserName\n        })\n        console.log(110,remoteUserName)\n        // ee.emit(\"VIDEO_READY\", remoteVideo, remoteUserName as string)\n      }\n\n    }\n\n    pc.onnegotiationneeded = onnegotiationneeded;\n    pc.onicecandidate = onicecandidate;\n    pc.ontrack = ontrack;\n    return pc;\n  }\n  async handleReceiveOffer(msg: any) {\n    //log(`receive remote description from ${msg.payload.from}`);\n\n    // 设置远端描述\n    //const remoteDescription = new RTCSessionDescription(msg.payload.sdp);\n    const remoteDescription = msg.payload.sdp;\n    let remoteUser = msg.payload.from;\n    console.log(remoteUser,msg,'120')\n    if (this.peerList[remoteUser]) return\n    let pc: RTCPeerConnection = this.createPeerConnection(remoteUser);\n    this.peerList[remoteUser] = pc\n\n    await pc.setRemoteDescription(remoteDescription); // TODO 错误处理\n\n    // 本地音视频采集\n    if(!this.is_audience&&this.local_video){\n      const mediaStream = this.local_video.srcObject as MediaStream;\n      mediaStream.getTracks().forEach(track => {\n        pc.addTrack(track, mediaStream);\n      });\n    }\n\n    const answer = await pc.createAnswer(); // TODO 错误处理\n    await pc.setLocalDescription(answer);\n    this.sendRTCEvent({\n      type: SIGNALING_ANSWER,\n      payload: {\n        sdp: answer,\n        from: this.userName,\n        target: remoteUser\n      }\n    });\n  }\n  async handleReceiveAnswer(msg: any) {\n    // log(`receive remote answer from ${msg.payload.from}`);\n\n    // const remoteDescription = new RTCSessionDescription(msg.payload.sdp);\n    const peerList = this.peerList\n    const remoteDescription = msg.payload.sdp;\n    let remoteUser = msg.payload.from;\n    if (peerList[remoteUser].signalingState !== \"stable\")\n      await peerList[remoteUser].setRemoteDescription(remoteDescription); // TODO 错误处理\n  }\n\n  async handleReceiveCandidate(msg: any) {\n    //   log(`receive candidate from ${msg.payload.from}`);\n    this.peerList[msg.payload.from].addIceCandidate(msg.payload.candidate); // TODO 错误处理\n  }\n\n  private sendRTCEvent(msg: any){\n    this.socket&&this.socket.emit(CLIENT_RTC_EVENT, JSON.stringify(msg));\n  }\n  private sendUserEvent(msg: any){\n    this.socket&&this.socket.emit(CLIENT_USER_EVENT, JSON.stringify(msg));\n}\n}\n\n\n\n","import React, { Component, useState, useEffect } from 'react';\nimport socket from \"./modules/Socket/index\"\nimport ee from './modules/eventEmitter'\nimport './App.css';\nimport ChatBox from \"./components/ChatBox\"\nimport Tips from './components/Tips';\nimport ParticipantsList from './components/ParticipantsList';\nimport { TEngine } from \"./modules/TEngine/TEngine\"\nimport { FaceAPI } from './modules/FaceAPI/FaceAPI';\nimport { HandAPI } from './modules/HandAPI/HandAPI';\nimport { basicObjectList } from './modules/TEngine/TBasicObject'\nimport { LightsList } from './modules/TEngine/Tlights'\nimport { helperList } from './modules/TEngine/THelper'\nimport { useLocation, useParams } from 'react-router-dom'\n// @ts-ignore\nimport * as humanseg from '@paddlejs-models/humanseg';\nimport { VCAPI } from './modules/VoiceControlAPI/VCAPI'\nimport { RTCEngine } from './modules/RTCEngine/RTCEngine';\nimport {\n  CLIENT_RTC_EVENT,\n  SERVER_RTC_EVENT,\n\n  CLIENT_USER_EVENT,\n  SERVER_USER_EVENT,\n  CLIENT_USER_EVENT_LOGIN,\n  SERVER_USER_EVENT_UPDATE_USERS,\n  CLIENT_USER_EVENT_SEND_MESSAGE,\n  SIGNALING_OFFER,\n  SIGNALING_ANSWER,\n  SIGNALING_CANDIDATE,\n} from './modules/constant'\nconst ROOMID = 100\n\nfunction App() {\n  const location: any = useLocation()\n  const { isAudience, browserType } = location.state;\n  const sceneList = {\n    '林间晨光': 'autumn_forest_04_1k',\n    '黄昏郊野': 'railway_bridges_1k',\n    '宁静湖畔': 'bell_park_pier_1k'\n  }\n\n  const [participantsList, setParticipantsList] = useState<Array<String>>([\"\"])\n  const [userName, setUserName] = useState<string>(location.state.username)\n\n  const [curScene, setCurScene] = useState('林间晨光')\n  let peerList: any = {};\n  let videoList: any = {};\n\n\n\n  //\n  useEffect(() => {\n    async function start() {\n      let client = new RTCEngine(socket, ee);\n      client.onnewuserenterroom = (e: any) => {\n        console.log('有人来了', e);\n        setParticipantsList(e.onlineUsers.map((u:any)=>u.userName))\n      }\n      client.onnewvideoloaded = (e: any) => {\n        console.log('视频准备好了', e)\n        const { video, video_name } = e\n        ee.emit(\"VIDEO_READY\", video, video_name);\n      }\n      client.onuserleaveroom = (e: any) => {\n        ee.emit('USER_LEAVE', e);\n      }\n      await new Promise((resolve, reject) => {\n        if (isAudience) { \n          (document.querySelector('.tips-wrapper') as HTMLDivElement).style.display = 'none';\n          resolve(0); \n        }\n        else {\n          (document.querySelector('.tips-enter-btn') as HTMLDivElement).onclick = () => {\n            (document.querySelector('.tips-wrapper') as HTMLDivElement).style.display = 'none';\n            resolve(0);\n          }\n        }\n      })\n\n      client.login(userName, '100', isAudience ? undefined : await createLocalVideo())\n\n    }\n    start()\n  }, [])\n  async function createLocalVideo() {\n    try {\n      await humanseg.load();\n    } catch (error) {\n      console.log(error)\n    }\n    const mediastream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    });\n    let w=mediastream.getVideoTracks()[0].getSettings().width as number/2;\n    let h=mediastream.getVideoTracks()[0].getSettings().height as number/2;\n    const hc = document.createElement('canvas');\n    hc.width = w;\n    hc.height = h;\n    const mc = document.createElement('canvas');\n    mc.width = w;\n    mc.height = h;\n    const bc = document.createElement('canvas');\n    bc.width = w;\n    bc.height = h;\n    const local_video = document.createElement('video');\n    local_video.muted = true;\n    local_video.autoplay = true;\n\n    local_video.width = w;\n    local_video.height = h;\n    const segment_video = document.createElement('video');\n    segment_video.width = w;\n    segment_video.height = h;\n    local_video.srcObject = mediastream;\n    local_video.play();\n    segment_video.srcObject = hc.captureStream();\n    segment(local_video, hc, mc, bc, () => { });\n\n    segment_video.onloadeddata = () => {\n      console.log('seg loaded')\n      segment_video.play();\n      ee.emit(\"VIDEO_READY\", segment_video, userName as string)\n    }\n    return segment_video\n  }\n\n  function cleanGreen(v: HTMLVideoElement, rv: HTMLVideoElement) {\n    const displayCanvasEl = document.createElement('canvas');\n    rv.srcObject = displayCanvasEl.captureStream();\n    const gl = displayCanvasEl.getContext(\"webgl\") as WebGLRenderingContext;\n    const vs = gl.createShader(gl.VERTEX_SHADER) as WebGLShader;\n    gl.shaderSource(vs, 'attribute vec2 c; void main(void) { gl_Position=vec4(c, 0.0, 1.0); }');\n    gl.compileShader(vs);\n    const fs = gl.createShader(gl.FRAGMENT_SHADER) as WebGLShader;\n    gl.shaderSource(fs, document.getElementById(\"fragment-shader\")!.innerText);\n    gl.compileShader(fs);\n    const prog = gl.createProgram() as WebGLProgram;\n    gl.attachShader(prog, vs);\n    gl.attachShader(prog, fs);\n    gl.linkProgram(prog);\n    gl.useProgram(prog);\n\n    const vb = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vb);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, 1, -1, -1, 1, -1, 1, 1]), gl.STATIC_DRAW);\n\n    const coordLoc = gl.getAttribLocation(prog, 'c');\n    gl.vertexAttribPointer(coordLoc, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(coordLoc);\n\n    gl.activeTexture(gl.TEXTURE0);\n    const tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n    const texLoc = gl.getUniformLocation(prog, \"tex\");\n    const texWidthLoc = gl.getUniformLocation(prog, \"texWidth\");\n    const texHeightLoc = gl.getUniformLocation(prog, \"texHeight\");\n    function processFrame(now: any, metadata: any) {\n      displayCanvasEl.width = metadata.width;\n      displayCanvasEl.height = metadata.height;\n      gl.viewport(0, 0, metadata.width, metadata.height);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, v);\n      gl.uniform1i(texLoc, 0);\n      gl.uniform1f(texWidthLoc, metadata.width);\n      gl.uniform1f(texHeightLoc, metadata.height);\n      gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);\n      //@ts-ignore\n      v.requestVideoFrameCallback(processFrame);\n    }\n    //@ts-ignore\n    v.requestVideoFrameCallback(processFrame);\n    console.log('执行了')\n  }\n\n  //3d场景生成\n  useEffect(() => {\n\n    const threeTarget = document.querySelector(\".conference-webgl-wrapper\")\n    const TE = new TEngine(threeTarget as HTMLElement, isAudience, browserType)\n\n    TE.loadRoom(() => {\n      document.querySelector('.mask')?.classList.remove('mask');\n    })\n\n    //TE.loadHumanModel()\n    TE.addObject(...basicObjectList)\n    TE.addObject(...LightsList)\n    TE.addObject(...helperList)\n    TE.loadLove()\n    ee.on(\"START_LOVE\", () => {\n      TE.startLove()\n    })\n\n    ee.on(\"CHANGE_SCENE\", (url: string) => {\n      TE.changeScene(url);\n    });\n    ee.on(\"ADJUST_BRIGHTNESS\", (type: string) => {\n      TE.adjustBrightness(type)\n    })\n    ee.on('USER_LEAVE', (leaveName: string) => {\n      console.log('996', leaveName)\n      TE.removeUserVideo(leaveName);\n    })\n    ee.on(\"VIDEO_READY\", (video: HTMLVideoElement, name: string) => {\n      //       const canvas = document.createElement('canvas');\n      console.log(video, name)\n      const resultVideo = document.createElement('video')\n      resultVideo.width = video.width;\n      resultVideo.muted = true;\n      resultVideo.height = video.height;\n      //       canvas.width=640;\n      // canvas.height=480;\n      //       // blurBackground(video, canvas)\n      //       // v.srcObject = canvas.captureStream()\n\n      //       v.srcObject=canvas.captureStream();\n      cleanGreen(video, resultVideo);\n      resultVideo.onloadeddata = () => {\n        resultVideo.play()\n        TE.addUserVideo(resultVideo, name)\n      }\n    })\n    window.addEventListener(\"keydown\", (e) => {\n      if (e.keyCode === 27) {\n\n        TE.disableControls()\n\n      } else if (e.keyCode === 17) {\n        TE.enableControls()\n      }\n    })\n  }, [])\n\n  //语音识别控制\n  useEffect(() => {\n    //@ts-ignore\n    if (window.webkitSpeechRecognition) {\n      let VC = new VCAPI()\n      VC.start()\n      console.log('vc open')\n      VC.bindListening('亮一点', () => {\n        console.log('捕捉到了>>>亮一点')\n        ee.emit('ADJUST_BRIGHTNESS', 'brighter')\n      })\n      VC.bindListening('暗一点', () => {\n        console.log('捕捉到了>>>暗一点')\n        ee.emit('ADJUST_BRIGHTNESS', 'darker')\n      })\n    }\n\n  }, [])\n\n  //手势识别\n  useEffect(() => {\n    return\n    ee.on(\"LOCAL_VIDEO\", async (video: HTMLVideoElement, canvas: HTMLCanvasElement) => {\n      const hd = new HandAPI();\n      (await hd.createDetector()).bindVideo(video).onDetect(() => {\n        ee.emit(\"START_LOVE\")\n      })\n\n    })\n  }, [])\n\n  async function segment(video: HTMLVideoElement, humanCanvas: HTMLCanvasElement, maskCanvas: HTMLCanvasElement, backgroundCanvas: HTMLCanvasElement, cb = (e: any) => { }) {\n    async function cutout() {\n      try {\n        const { data } = await humanseg.getGrayValue(video);\n        humanseg.drawHumanSeg(data, humanCanvas);\n        // humanseg.drawMask(data,maskCanvas,backgroundCanvas);\n        // cb(data)\n      } catch (error) {\n        console.log(error);\n      }\n\n      requestAnimationFrame(cutout)\n    }\n    cutout()\n  }\n\n\n  return (\n    <div className=\"App sm-app\">\n      <div className='app-main-box sm-app-main-box'>\n        <div className=\"conference-header-wrapper\" >\n          <div className='header-item' onClick={() => {\n\n          }}>欢迎{userName}</div>\n          <div className='header-item dropdown'>\n            <h5>{curScene}</h5>\n            <div className='dropdown-content'>\n              {\n                Object.keys(sceneList).map((key) => {\n                  return (\n                    <p onClick={() => {\n                      setCurScene(key);\n                      //@ts-ignore\n                      ee.emit('CHANGE_SCENE', sceneList[key])\n                    }}>{key}</p>\n                  )\n                })\n              }\n            </div>\n\n\n          </div>\n        </div>\n        <div className=\"conference-body-wrapper mask\" data-loadinfo=\"三维会议室加载中\">\n          <Tips></Tips>\n          <div className=\"conference-webgl-wrapper\"></div>\n\n        </div>\n        <div className=\"conference-footer-wrapper\" onClick={() => {\n\n        }}>\n          <div className='function-btn selected' onClick={(e) => {\n            const dom = e.target as HTMLDivElement;\n            const selected = dom.classList.contains('selected');\n            const chatBoxDom = document.querySelector('.conference-textchat-wrapper') as HTMLDivElement;\n            const addSpace = document.querySelector('.userlist-btn')?.classList.contains('selected') && !selected;\n            addSpace && chatBoxDom.classList.add('add-space');\n            !addSpace && chatBoxDom.classList.remove('add-space');\n            console.log(addSpace)\n            if (selected) {\n              dom.classList.remove('selected');\n              chatBoxDom.classList.add('hide');\n\n            } else {\n              dom.classList.add('selected');\n\n              chatBoxDom.classList.remove('hide');\n\n            }\n          }}>\n            💬\n          </div>\n          <div className='userlist-btn function-btn ' onClick={(e) => {\n            const dom = e.target as HTMLDivElement;\n            const selected = dom.classList.contains('selected');\n            const listDom = document.querySelector('.conference-participants-list-wrapper') as HTMLDivElement;\n            const chatBoxDom = document.querySelector('.conference-textchat-wrapper') as HTMLDivElement;\n            const addSpace = !chatBoxDom.classList.contains('hide') && !selected;\n            addSpace && chatBoxDom.classList.add('add-space');\n            !addSpace && chatBoxDom.classList.remove('add-space');\n            if (selected) {\n              dom.classList.remove('selected');\n              listDom.classList.add('hide');\n            } else {\n              dom.classList.add('selected');\n              listDom.classList.remove('hide');\n            }\n          }} >\n            👥\n          </div>\n        </div>\n      </div>\n      <div className='app-function-box sm-app-function-box'>\n        <div className=\"conference-participants-list-wrapper sm-conference-participants-list-wrapper hide\">\n          <ParticipantsList participantsList={participantsList} />\n        </div>\n        <div className=\"conference-textchat-wrapper sm-conference-textchat-wrapper\">\n          <ChatBox userName={userName} />\n        </div>\n      </div>\n\n    </div>\n  );\n}\n\nexport default App;\n","export function BrowserType() {\n    const ua = navigator.userAgent.toLowerCase();\n    const testUa = (regexp: RegExp) => regexp.test(ua);\n    const testVs = (regexp: { [Symbol.match](string: string): RegExpMatchArray | null; }) => (ua.match(regexp) + \"\").replace(/[^0-9|_.]/ig, \"\").replace(/_/ig, \".\");\n    // 接上以上if...else条件判断\n    let system = \"unknown\";\n    if (testUa(/oculus|quest/ig)) {\n        system = \"oculus\";\n    } else if (testUa(/windows|win32|win64|wow32|wow64/ig)) {\n        system = \"windows\"; // window系统\n    } else if (testUa(/macintosh|macintel/ig)) {\n        system = \"osx\"; // osx系统\n    } else if (testUa(/x11/ig)) {\n        system = \"linux\"; // linux系统\n    } else if (testUa(/android|adr/ig)) {\n        system = \"android\"; // android系统\n    } else if (testUa(/ios|iphone|ipad|ipod|iwatch/ig)) {\n        system = \"ios\"; // ios系统\n    }\n\n    // ......\n    // 获取到system、systemVs、platform、engine、engineVs、supporter、supporterVs、shell、shellVs\n    return system\n}","import React, { useEffect, useState } from 'react'\nimport './Login.css'\n// @ts-ignore\nimport { useNavigate } from 'react-router-dom'\nimport { BrowserType } from './utils'\nimport {\n  CLIENT_RTC_EVENT,\n  SERVER_RTC_EVENT,\n\n  CLIENT_USER_EVENT,\n  SERVER_USER_EVENT,\n  CLIENT_USER_EVENT_LOGIN,\n  SERVER_USER_EVENT_UPDATE_USERS,\n  CLIENT_USER_EVENT_SEND_MESSAGE,\n  SIGNALING_OFFER,\n  SIGNALING_ANSWER,\n  SIGNALING_CANDIDATE,\n} from './modules/constant'\nconst ROOMID = 100;\nconst browserType=BrowserType()\nfunction Login() {\n  const to = useNavigate()\n  return (\n    <div className='login-wrapper'>\n      <div className='login-form-wrapper'>\n        <div className='title'>mushroom</div>\n        <div className='login-form'>\n          <div className='form-option'>\n            <h4>用户名</h4>\n            <input type=\"text\" id='name' placeholder='输入用户名' required />\n          </div>\n          <div className='form-option' style={{display:'none'}}>\n            <h6>房间号</h6>\n            <input type=\"text\" id='num' placeholder='输入房间号' required />\n          </div>\n          <div className={`form-option radio-option ${browserType==='oculus'?'hiden':''}`} >\n            <span>观众访问？</span>\n            <input type=\"radio\" id='auth' name='auth' value='true' />\n          </div>\n\n          <button className=\"btn\"\n            onClick={() => {\n              const username = (document.getElementById('name') as HTMLInputElement).value;\n              const roomid = (document.getElementById('num') as HTMLInputElement).value;\n              const isAudience =browserType==='oculus'|| (document.getElementById('auth') as HTMLInputElement).checked;\n\n              //  userLogin(username)\n              to('/room', {\n                state: {\n                  username,\n                  roomid,\n                  isAudience,\n                  browserType\n                }\n              })\n\n            }}>\n            进入房间\n          </button>\n          <div className='hide' >\n            <div>{BrowserType()}</div>\n            <div>{\n              //@ts-ignore\n              `webkitSpeechRecognition ${window.webkitSpeechRecognition ? 'ok' : 'no'}`\n            }\n            </div>\n            <div>\n              {\n                //@ts-ignore\n                `requestAnimationFrame ${window.requestAnimationFrame ? 'ok' : 'no'}`\n              }\n\n            </div>\n            <div>\n              {\n                //@ts-ignore\n               `requestVideoFrameCallback ${document.createElement('video').requestVideoFrameCallback ? 'ok' : 'no'}`\n              }\n            </div>\n          </div>\n        </div>\n\n\n      </div>\n      <div className='login-img'>\n        <div className='info'>\n          <div className='title'>mushroom</div>\n          <div>\n            三维视频会议室\n          </div>\n        </div>\n        <img src=\"/viewfile.png\" alt=\"#\" />\n\n      </div>\n    </div>\n  )\n}\nexport default Login\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n// @ts-ignore\nimport { BrowserRouter as Router, Route, Link, Routes } from \"react-router-dom\";\nimport './index.css';\nimport App from './App';\nimport Login from './Login';\n\n\nReactDOM.render(\n\n  <Router>\n    <Routes>\n      <Route path='/' element={<Login/>}/>\n      <Route path='/room' element={<App/>}/>\n    </Routes>\n  </Router>\n  ,\n  document.getElementById('root')\n);\n\n\n"],"sourceRoot":""}