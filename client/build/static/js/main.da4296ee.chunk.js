(this["webpackJsonp3d-conference-room"]=this["webpackJsonp3d-conference-room"]||[]).push([[0],{276:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},285:function(e,t,n){},286:function(e,t,n){},288:function(e,t){},289:function(e,t){},297:function(e,t){},298:function(e,t,n){},300:function(e,t,n){"use strict";n.r(t);var a=n(21),i=n(228),r=n.n(i),s=n(152),o=n(28),c=(n(276),n(20)),d=n(10),l=n.n(d),u=n(18),h=n(9),p=n(256),m=Object(p.a)("https://www.dramalf.xyz"),v=new(n(281)),f=(n(282),n(283),"CLIENT_USER_EVENT"),b="SERVER_USER_EVENT",w="SIGNALING_OFFER",j="SIGNALING_ANSWER",g="SIGNALING_CANDIDATE",x=n(19);function E(e){var t=Object(a.useState)([]),n=Object(h.a)(t,2);n[0],n[1];function i(e){var t;t={type:"CLIENT_USER_EVENT_SEND_MESSAGE",payload:e},m.emit(f,JSON.stringify(t))}function r(e){var t=e.message,n=e.userName,a=e.isSelf,i=e.timeStamp,r=document.createElement("div"),s=document.createElement("div");return r.classList.add("msg-wrapper"),s.className="message ".concat(a?"my-message":"other-message"),s.setAttribute("data-username",a?"":n),s.setAttribute("data-time",new Date(i).toTimeString().substr(0,8)),r.appendChild(s),s.innerText=t,r}return Object(a.useEffect)((function(){var e=document.querySelector(".chat-record-panel");return m.on(b,(function(t){var n=t.type,a=t.payload;"SERVER_USER_EVENT_BROADCAST_MESSAGE"===n&&(!function(t){var n={userName:t.userName,message:t.message,isSelf:!1,timeStamp:Date.now()};e.appendChild(r(n)),e.scrollTop=e.scrollHeight}(a),console.log("revieve new msg"))})),function(){m.removeAllListeners()}}),[]),Object(x.jsxs)("div",{className:"chat-box-wrapper",children:[Object(x.jsx)("div",{className:"chat-record-panel",children:Object(x.jsx)("h4",{children:"\u804a\u5929"})}),Object(x.jsxs)("div",{className:"send-msg-part",children:[Object(x.jsx)("div",{className:"input-panel",children:Object(x.jsx)("textarea",{name:"comment",contentEditable:!0,"data-text":"\u8f93\u5165\u5185\u5bb9..."})}),Object(x.jsxs)("div",{className:"send-msg-btn",onClick:function(){var t=document.querySelector(".chat-record-panel"),n=document.querySelector(".input-panel textarea"),a=n.value;if(a){i({userName:e.userName,message:a,roomID:100});var s={userName:e.userName,message:a,isSelf:!0,timeStamp:Date.now()};t.appendChild(r(s)),t.scrollTop=t.scrollHeight,n.value=""}},children:[Object(x.jsx)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2268",width:"200",height:"200",children:Object(x.jsx)("path",{d:"M392.021333 925.013333a34.133333 34.133333 0 0 1-34.133333-34.133333V579.242667c0-10.24 4.608-19.968 12.629333-26.453334l276.48-224.085333a34.0992 34.0992 0 0 1 43.008 52.906667L426.154667 595.456v192.853333l82.944-110.592c10.069333-13.482667 28.672-17.578667 43.52-9.557333l137.557333 73.728L853.333333 156.16c3.242667-11.434667-3.413333-18.602667-6.485333-21.162667-3.072-2.56-11.093333-7.850667-21.845333-2.901333L206.336 422.4l80.213333 46.08c16.384 9.386667 22.016 30.208 12.629334 46.592s-30.208 22.016-46.592 12.629333l-137.045334-78.677333a33.979733 33.979733 0 0 1-17.066666-31.061333c0.512-12.8 8.021333-24.064 19.626666-29.525334L795.989333 70.314667c31.744-14.848 68.096-10.069333 94.890667 12.629333a87.790933 87.790933 0 0 1 28.16 91.477333L744.277333 801.28a34.082133 34.082133 0 0 1-48.981333 20.821333L546.133333 742.058667l-126.805333 169.301333c-6.656 8.704-16.896 13.653333-27.306667 13.653333z","p-id":"2269",fill:"#e6e6e6"})}),"                "]})]})]})}n(285);var O=function(e){return Object(x.jsx)("div",{className:"tips-wrapper",children:Object(x.jsxs)("div",{className:"tips-box",children:[Object(x.jsx)("h4",{children:"\u63d0\u793a"}),Object(x.jsxs)("div",{className:"info-box",children:[" ",Object(x.jsx)("div",{children:"\u4f1a\u8bae\u671f\u95f4\u4f1a\u4f7f\u7528\u5230\u60a8\u7684\u6444\u50cf\u5934\u6216\u9ea6\u514b\u98ce"}),Object(x.jsx)("div",{children:"\u89c2\u4f17\u53ef\u4ee5\u9009\u62e9VR\u6a21\u5f0f\u65c1\u542c\u4f1a\u8bae"}),Object(x.jsx)("div",{children:"\u58f0\u63a7\u548c\u624b\u52bf\u8bc6\u522b\u529f\u80fd\u53ef\u6839\u636e\u4e2a\u4eba\u9700\u8981\u548c\u8bbe\u5907\u6027\u80fd\u9009\u62e9\u5f00\u542f"})]}),Object(x.jsx)("div",{className:"tips-enter-btn",children:"\u8fdb\u5165\u4f1a\u8bae"})]})})};n(286);function y(e){return Object(x.jsxs)("div",{className:"user-list-wrapper",children:[Object(x.jsx)("h4",{children:"\u4e0e\u4f1a\u5217\u8868"}),Object(x.jsx)("div",{className:"user-list-box",children:e.participantsList.map((function(e){return Object(x.jsx)("div",{"data-name":e,children:e},e.toString())}))})]})}var S=n(3),k=n(7),N=n(8),_=n(164),T=n(232),R=n(233),L=n(234),A=n(165),C=n(166),I=[],V=new N.a("rgb(64,64,64)",.2),D=new N.ib("rgb(240, 225, 240)",1);D.position.set(0,20,0);var U=new N.Ab("rgb(255, 255, 255)",1,200,Math.PI,0,0);U.castShadow=!0,U.position.set(0,200,0),I.push(U,D);var P=n(235),M=function(){function e(t){var n=this,a=arguments.length>2?arguments[2]:void 0;Object(S.a)(this,e),this.dom=void 0,this.renderer=void 0,this.mixer=void 0,this.pmremGenerator=void 0,this.scene=void 0,this.camera=void 0,this.ambientLight=void 0,this.clock=void 0,this.controls=void 0,this.seatsPosition=[{x:-38,y:29,z:0},{x:-20,y:29,z:-20},{x:0,y:29,z:-20},{x:26,y:29,z:-20},{x:38,y:29,z:0},{x:26,y:29,z:20},{x:0,y:29,z:20},{x:-20,y:29,z:20}],this.userVideoBoxes=[],this.model=void 0,this.heart=void 0,this.newEnterIndex=0,this.stats=void 0,this.dom=t,this.renderer=new N.Nb({antialias:!0}),this.clock=new N.j,this.renderer.shadowMap.enabled=!0,this.renderer.toneMapping=N.L,this.ambientLight=V,this.scene=new N.vb,this.scene.add(this.ambientLight);var i=new N.eb(this.renderer);i.compileEquirectangularShader(),this.pmremGenerator=i;var r=this.scene;new N.w(16777147,32,1);(new C.a).setDataType(N.Ib).load("/texture/autumn_forest_04_1k.hdr",(function(e){var t=i.fromEquirectangular(e).texture;i.dispose(),console.log("here"),r.environment=t,r.background=t}),(function(){}),(function(e){console.log("error in load env_texture",e)})),this.camera=new N.fb(60,t.offsetWidth/t.offsetHeight,1,1e3),this.renderer.setSize(t.offsetWidth,t.offsetHeight,!0);var s,o=Object(T.a)(),c=o.domElement;this.stats=o,c.style.position="fixed",c.style.top="0",c.style.right="5px",c.style.left="unset";var d="oculus"===a||"android"===a||"ios"===a;d?((s=new R.a(this.camera,this.dom)).enableDamping=!0,s.dampingFactor=.05,s.screenSpacePanning=!1,s.target=new N.Kb(0,28,0),s.maxPolarAngle=Math.PI/2+.001,s.minPolarAngle=Math.PI/2,s.update()):((s=new L.a(this.camera,this.dom)).lookSpeed=.2,s.movementSpeed=20,s.constrainVertical=!0,s.verticalMin=Math.PI/2,s.verticalMax=Math.PI/2+1e-7),this.controls=s,this.controls.object.position.set(-38,28,0),this.controls.object.lookAt(new N.Kb(0,0,0)),this.camera.up=new N.Kb(0,1,0),d&&this.controls.update();var l=function(){n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(t.offsetWidth,t.offsetHeight,!0)};window.addEventListener("resize",l),this.renderer.setAnimationLoop((function(){!d&&n.controls.update(n.clock.getDelta()),d&&n.controls.update(),n.renderer.render(n.scene,n.camera),o.update(),_.b(),n.updateUserVideoRotation()})),t.appendChild(this.renderer.domElement),t.appendChild(c),t.appendChild(P.a.createButton(this.renderer))}return Object(k.a)(e,[{key:"loadRoom",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=new A.a;n.load("/models/table/scene.gltf",(function(n){n.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.frustumCulled=!1,e.material.emissive=e.material.color,e.material.emissiveMap=e.material.map)})),n.scene.receiveShadow=!0,e.model=n.scene,e.scene.add(n.scene),n.scene.position.set(0,0,0),n.scene.scale.set(.3,.3,.3),t()}),(function(){}),(function(e){console.log("error",e)}))}},{key:"load_sprite",value:function(){var e=this,t=new N.cb;console.log("120"),t.load("/models/sprite/sprite.json",(function(t){e.scene.add(t),t.position.set(-29,30,-20),t.scale.set(10,10,10),console.log(t,120)}),(function(){}),(function(e){console.log("error",e)}))}},{key:"addObject",value:function(){for(var e=this,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];n.forEach((function(t){e.scene.add(t)}))}},{key:"updateUserVideoRotation",value:function(){var e=this;this.userVideoBoxes.map((function(t,n){if(t){var a=t.object,i=e.camera.position.clone(),r=a.position.clone(),s=Math.atan((r.x-i.x)/(r.z-i.z));a.rotation.y=s}}))}},{key:"changeScene",value:function(e){var t=this;(new C.a).setDataType(N.Ib).load("/texture/".concat(e,".hdr"),(function(e){var n=t.pmremGenerator.fromEquirectangular(e).texture;t.pmremGenerator.dispose(),t.scene.environment=n,t.scene.background=n}),(function(){}),(function(e){console.log("123,",e)}))}},{key:"addUserVideo",value:function(e,t){var n=new N.hb(48,36,96,72),a=new N.Mb(e);a.format=N.qb;var i=new N.T({map:a,transparent:!0,side:N.o});i.needsUpdate=!0;var r=new N.S(n,i),s=this.seatsPosition[this.newEnterIndex],o=s.x,c=s.y,d=s.z;this.newEnterIndex++,r.position.set(o,c,d),r.scale.set(.4,.4,.4),this.userVideoBoxes.push({object:r,videoName:t}),this.scene.add(r)}},{key:"removeUserVideo",value:function(e){var t=this;this.userVideoBoxes=this.userVideoBoxes.filter((function(n){return n.videoName===e&&(console.log("997",n),n.object.material.dispose(),n.object.geometry.dispose(),t.scene.remove(n.object)),n.videoName!==e}))}},{key:"adjustBrightness",value:function(e){"brighter"===e?(console.log("\u4eae\u4e00\u70b9"),this.renderer.toneMappingExposure+=.1):(console.log("\u6697\u4e00\u70b9"),this.renderer.toneMappingExposure-=.1)}},{key:"startLove",value:function(){var e=this.heart.clone();this.scene.add(e);var t=new N.Kb(-20,24,-18),n=new N.Kb(-32,36,-10),a=new N.Kb(-38,24,0);var i=function(t){var n=t.map((function(n,a,i){if(a<t.length-2){var r=new _.a(n).to(i[a+1],10);return r.onUpdate((function(t){e.position.set(t.x,t.y,t.z)})),r}}));n.pop(),console.log(n,998);for(var a=0;a<t.length-1;a++)n[a+1]&&n[a]&&n[a].chain(n[a+1]);return n[0]}(new N.nb(t,n,a).getPoints(50));null===i||void 0===i||i.start()}},{key:"loadLove",value:function(){var e=this;(new A.a).load("/models/heart_in_love/scene.gltf",(function(t){t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.frustumCulled=!1,e.material.emissive=e.material.color,e.material.emissiveMap=e.material.map)})),t.scene.receiveShadow=!0,e.heart=t.scene,t.scene.scale.set(.01,.01,.01)}),(function(){}),(function(e){console.log("error",e)}))}},{key:"disableControls",value:function(){this.controls.enabled=!1}},{key:"enableControls",value:function(){this.controls.enabled=!0}}]),e}(),q=(n(168),n(299),new N.Fb),B=q.load("./texture/wood.jpeg");B.wrapS=N.ub,B.wrapT=N.ub,B.repeat.set(10,4);var G=q.load("./texture/wall2.jpg");G.wrapS=N.ub,G.wrapT=N.ub,G.repeat.set(10,4);var F=[];new N.S(new N.f(10,20,10),new N.V({map:B})).position.x=0;var z=new N.S(new N.f(200,10,200),new N.V({map:B}));z.castShadow=!0,z.receiveShadow=!0,z.position.y=-5;var H=new N.S(new N.f(2,10,2),new N.V({color:"#b57355",metalness:.5,roughness:.3}));H.castShadow=!0,H.receiveShadow=!0,H.position.set(-10,5,-10),new N.S(new N.gb(100,40),new N.V({map:G,side:N.o})).position.set(0,20,-50);var J=new N.S(new N.gb(100,40),new N.V({map:G,side:N.o}));J.rotateY(Math.PI/2),J.position.set(-50,20,0);var X=new N.S(new N.gb(100,40),new N.V({map:G,side:N.o}));X.rotateY(Math.PI/2),X.position.set(50,20,0),new N.S(new N.gb(100,40),new N.V({map:G,side:N.o})).position.set(0,20,50),F.push(z);var W=[],Y=new N.c(500);new N.t(500,20,"rgb(200, 200, 200)","rgb(100, 100, 100)"),new N.jb(D,D.distance,D.color),new N.Bb(U,U.color);W.push(Y);var K=n(160),Q=window.webkitSpeechRecognition,Z=function e(){var t=this;Object(S.a)(this,e),this.recognition=new Q,this.listenedEvent=[],this.stop=function(){t.recognition.stop()},this.start=function(){t.recognition.start()},this.bindListening=function(e,n){t.listenedEvent.push({keyword:e,callback:n})},this.recognition.continuous=!0,this.recognition.lang="cmn-Hans-CN",this.recognition.interimResults=!0;var n="",a=!1;this.recognition.onresult=function(e){var i=e.resultIndex,r=e.results[i][0].transcript;if(console.log(r),r.length&&!a){var s=r.length;n=r.substr(s-10?s-10:0,s-10?10:s),t.listenedEvent.some((function(e){var t=e.keyword,i=e.callback;n.indexOf(t)>=0&&(a=!0,setTimeout((function(){a=!1}),2e3),i())}))}}},$=function(){function e(t,n){var a=this;Object(S.a)(this,e),this.peerList={},this.videoList={},this.userName=void 0,this.local_video=void 0,this.is_audience=!1,this.socket=void 0,this.ee=void 0,this.onnewuserenterroom=void 0,this.onnewvideoloaded=void 0,this.onuserleaveroom=void 0,this.ee=n,this.socket=t,t.on("FIRSTASKLIST",(function(e){console.log("User first time get all online users list");var t=JSON.parse(e);a.onnewuserenterroom&&a.onnewuserenterroom(t),a.initRTC(t.onlineUsers)})),t.on("user_leave",(function(e){console.log("in rtc "),a.onuserleaveroom&&a.onuserleaveroom(e)})),t.on(b,(function(e){var t=e.type,n=e.payload;if("SERVER_USER_EVENT_UPDATE_USERS"===t)a.onnewuserenterroom&&a.onnewuserenterroom(n)})),t.on("SERVER_RTC_EVENT",function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.type,e.t0=n,e.next=e.t0===w?4:e.t0===j?6:e.t0===g?9:12;break;case 4:return a.handleReceiveOffer(t),e.abrupt("break",12);case 6:return e.next=8,a.handleReceiveAnswer(t);case 8:case 11:return e.abrupt("break",12);case 9:return e.next=11,a.handleReceiveCandidate(t);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}return Object(k.a)(e,[{key:"initRTC",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.local_video,n=this.is_audience,t.length>1&&t.forEach((function(e){var t=e.userName;if(!a.peerList[t]&&t!==a.userName){var i=a.createPeerConnection(t);if(a.peerList[t]=i,!n){var r=a.local_video.srcObject;r.getTracks().forEach((function(e){i.addTrack(e,r)}))}}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(e,t,n){n?(this.is_audience=!1,this.local_video=n):this.is_audience=!0,this.userName=e;var a={type:"CLIENT_USER_EVENT_LOGIN",payload:{loginName:e,roomID:100}};this.socket.emit(f,JSON.stringify(a))}},{key:"createPeerConnection",value:function(e){var t=this,n=this.userName,a=new RTCPeerConnection({iceServers:[{url:"stun:stun.ekiga.net"},{url:"turn:turnserver.com",username:"user",credential:"pass"}]}),i=function(){var i=Object(u.a)(l.a.mark((function i(r){var s;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.createOffer();case 2:return s=i.sent,i.next=5,a.setLocalDescription(s);case 5:t.sendRTCEvent({type:w,payload:{from:n,target:e,sdp:a.localDescription}});case 6:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}(),r=function(){var a=Object(u.a)(l.a.mark((function a(i){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:i.candidate&&t.sendRTCEvent({type:g,payload:{from:n,target:e,candidate:i.candidate}});case 1:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}();return a.onnegotiationneeded=i,a.onicecandidate=r,a.ontrack=function(n){var a=t.videoList[e];if(a){if(a.srcObject)return;a.srcObject=n.streams[0]}else(a=document.createElement("video")).srcObject=n.streams[0],a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.width=640,a.height=480,t.videoList[e]=a,a.play(),t.onnewvideoloaded&&t.onnewvideoloaded({video:a,video_name:e}),console.log(110,e)},a}},{key:"handleReceiveOffer",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,i,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.payload.sdp,a=t.payload.from,console.log(a,t,"120"),!this.peerList[a]){e.next=5;break}return e.abrupt("return");case 5:return i=this.createPeerConnection(a),this.peerList[a]=i,e.next=9,i.setRemoteDescription(n);case 9:return!this.is_audience&&this.local_video&&(r=this.local_video.srcObject).getTracks().forEach((function(e){i.addTrack(e,r)})),e.next=12,i.createAnswer();case 12:return s=e.sent,e.next=15,i.setLocalDescription(s);case 15:this.sendRTCEvent({type:j,payload:{sdp:s,from:this.userName,target:a}});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleReceiveAnswer",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.peerList,a=t.payload.sdp,i=t.payload.from,"stable"===n[i].signalingState){e.next=6;break}return e.next=6,n[i].setRemoteDescription(a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleReceiveCandidate",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.peerList[t.payload.from].addIceCandidate(t.payload.candidate);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRTCEvent",value:function(e){this.socket&&this.socket.emit("CLIENT_RTC_EVENT",JSON.stringify(e))}},{key:"sendUserEvent",value:function(e){this.socket&&this.socket.emit(f,JSON.stringify(e))}}]),e}();var ee=function(){var e=Object(o.e)(),t=e.state,n=t.isAudience,i=t.browserType,r={"\u6797\u95f4\u6668\u5149":"autumn_forest_04_1k","\u9ec4\u660f\u90ca\u91ce":"railway_bridges_1k","\u5b81\u9759\u6e56\u7554":"bell_park_pier_1k"},s=Object(a.useState)([""]),d=Object(h.a)(s,2),p=d[0],f=d[1],b=Object(a.useState)(e.state.username),w=Object(h.a)(b,2),j=w[0],g=(w[1],Object(a.useState)("\u6797\u95f4\u6668\u5149")),S=Object(h.a)(g,2),k=S[0],N=S[1];function _(){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(l.a.mark((function e(){var t,n,a,i,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.load();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:return e.next=10,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 10:return t=e.sent,n=t.getVideoTracks()[0].getSettings().width/2,a=t.getVideoTracks()[0].getSettings().height/2,(i=document.createElement("canvas")).width=n,i.height=a,(r=document.createElement("canvas")).width=n,r.height=a,(s=document.createElement("canvas")).width=n,s.height=a,(o=document.createElement("video")).muted=!0,o.autoplay=!0,o.width=n,o.height=a,(c=document.createElement("video")).width=n,c.height=a,o.srcObject=t,o.play(),c.srcObject=i.captureStream(),R(o,i,r,s,(function(){})),c.onloadeddata=function(){console.log("seg loaded"),c.play(),v.emit("VIDEO_READY",c,j)},e.abrupt("return",c);case 36:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function R(e,t,n,a){return L.apply(this,arguments)}function L(){return L=Object(u.a)(l.a.mark((function e(t,n,a,i){var r,s,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=function(){return(s=Object(u.a)(l.a.mark((function e(){var a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.getGrayValue(t);case 3:a=e.sent,i=a.data,K.drawHumanSeg(i,n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:requestAnimationFrame(r);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)},r=function(){return s.apply(this,arguments)},o.length>4&&void 0!==o[4]?o[4]:function(e){},r();case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}return Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new $(m,v)).onnewuserenterroom=function(e){console.log("\u6709\u4eba\u6765\u4e86",e),f(e.onlineUsers.map((function(e){return e.userName})))},t.onnewvideoloaded=function(e){console.log("\u89c6\u9891\u51c6\u5907\u597d\u4e86",e);var t=e.video,n=e.video_name;v.emit("VIDEO_READY",t,n)},t.onuserleaveroom=function(e){v.emit("USER_LEAVE",e)},e.next=6,new Promise((function(e,t){n?(document.querySelector(".tips-wrapper").style.display="none",e(0)):document.querySelector(".tips-enter-btn").onclick=function(){document.querySelector(".tips-wrapper").style.display="none",e(0)}}));case 6:if(e.t0=t,e.t1=j,!n){e.next=12;break}e.t2=void 0,e.next=15;break;case 12:return e.next=14,_();case 14:e.t2=e.sent;case 15:e.t3=e.t2,e.t0.login.call(e.t0,e.t1,"100",e.t3);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(a.useEffect)((function(){var e=document.querySelector(".conference-webgl-wrapper"),t=new M(e,n,i);t.loadRoom((function(){var e;null===(e=document.querySelector(".mask"))||void 0===e||e.classList.remove("mask")})),t.addObject.apply(t,Object(c.a)(F)),t.addObject.apply(t,Object(c.a)(I)),t.addObject.apply(t,Object(c.a)(W)),t.loadLove(),v.on("START_LOVE",(function(){t.startLove()})),v.on("CHANGE_SCENE",(function(e){t.changeScene(e)})),v.on("ADJUST_BRIGHTNESS",(function(e){t.adjustBrightness(e)})),v.on("USER_LEAVE",(function(e){console.log("996",e),t.removeUserVideo(e)})),v.on("VIDEO_READY",(function(e,n){console.log(e,n);var a=document.createElement("video");a.width=e.width,a.muted=!0,a.height=e.height,function(e,t){var n=document.createElement("canvas");t.srcObject=n.captureStream();var a=n.getContext("webgl"),i=a.createShader(a.VERTEX_SHADER);a.shaderSource(i,"attribute vec2 c; void main(void) { gl_Position=vec4(c, 0.0, 1.0); }"),a.compileShader(i);var r=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(r,document.getElementById("fragment-shader").innerText),a.compileShader(r);var s=a.createProgram();a.attachShader(s,i),a.attachShader(s,r),a.linkProgram(s),a.useProgram(s);var o=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,1,1]),a.STATIC_DRAW);var c=a.getAttribLocation(s,"c");a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(c),a.activeTexture(a.TEXTURE0);var d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);var l=a.getUniformLocation(s,"tex"),u=a.getUniformLocation(s,"texWidth"),h=a.getUniformLocation(s,"texHeight");e.requestVideoFrameCallback((function t(i,r){n.width=r.width,n.height=r.height,a.viewport(0,0,r.width,r.height),a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,e),a.uniform1i(l,0),a.uniform1f(u,r.width),a.uniform1f(h,r.height),a.drawArrays(a.TRIANGLE_FAN,0,4),e.requestVideoFrameCallback(t)})),console.log("\u6267\u884c\u4e86")}(e,a),a.onloadeddata=function(){a.play(),t.addUserVideo(a,n)}})),window.addEventListener("keydown",(function(e){27===e.keyCode?t.disableControls():17===e.keyCode&&t.enableControls()}))}),[]),Object(a.useEffect)((function(){if(window.webkitSpeechRecognition){var e=new Z;e.start(),console.log("vc open"),e.bindListening("\u4eae\u4e00\u70b9",(function(){console.log("\u6355\u6349\u5230\u4e86>>>\u4eae\u4e00\u70b9"),v.emit("ADJUST_BRIGHTNESS","brighter")})),e.bindListening("\u6697\u4e00\u70b9",(function(){console.log("\u6355\u6349\u5230\u4e86>>>\u6697\u4e00\u70b9"),v.emit("ADJUST_BRIGHTNESS","darker")}))}}),[]),Object(a.useEffect)((function(){}),[]),Object(x.jsxs)("div",{className:"App sm-app",children:[Object(x.jsxs)("div",{className:"app-main-box sm-app-main-box",children:[Object(x.jsxs)("div",{className:"conference-header-wrapper",children:[Object(x.jsxs)("div",{className:"header-item",onClick:function(){},children:["\u6b22\u8fce",j]}),Object(x.jsxs)("div",{className:"header-item dropdown",children:[Object(x.jsx)("h5",{children:k}),Object(x.jsx)("div",{className:"dropdown-content",children:Object.keys(r).map((function(e){return Object(x.jsx)("p",{onClick:function(){N(e),v.emit("CHANGE_SCENE",r[e])},children:e})}))})]})]}),Object(x.jsxs)("div",{className:"conference-body-wrapper mask","data-loadinfo":"\u4e09\u7ef4\u4f1a\u8bae\u5ba4\u52a0\u8f7d\u4e2d",children:[Object(x.jsx)(O,{}),Object(x.jsx)("div",{className:"conference-webgl-wrapper"})]}),Object(x.jsxs)("div",{className:"conference-footer-wrapper",onClick:function(){},children:[Object(x.jsx)("div",{className:"function-btn selected",onClick:function(e){var t,n=e.target,a=n.classList.contains("selected"),i=document.querySelector(".conference-textchat-wrapper"),r=(null===(t=document.querySelector(".userlist-btn"))||void 0===t?void 0:t.classList.contains("selected"))&&!a;r&&i.classList.add("add-space"),!r&&i.classList.remove("add-space"),console.log(r),a?(n.classList.remove("selected"),i.classList.add("hide")):(n.classList.add("selected"),i.classList.remove("hide"))},children:"\ud83d\udcac"}),Object(x.jsx)("div",{className:"userlist-btn function-btn ",onClick:function(e){var t=e.target,n=t.classList.contains("selected"),a=document.querySelector(".conference-participants-list-wrapper"),i=document.querySelector(".conference-textchat-wrapper"),r=!i.classList.contains("hide")&&!n;r&&i.classList.add("add-space"),!r&&i.classList.remove("add-space"),n?(t.classList.remove("selected"),a.classList.add("hide")):(t.classList.add("selected"),a.classList.remove("hide"))},children:"\ud83d\udc65"})]})]}),Object(x.jsxs)("div",{className:"app-function-box sm-app-function-box",children:[Object(x.jsx)("div",{className:"conference-participants-list-wrapper sm-conference-participants-list-wrapper hide",children:Object(x.jsx)(y,{participantsList:p})}),Object(x.jsx)("div",{className:"conference-textchat-wrapper sm-conference-textchat-wrapper",children:Object(x.jsx)(E,{userName:j})})]})]})};n(298);function te(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n="unknown";return t(/oculus|quest/gi)?n="oculus":t(/windows|win32|win64|wow32|wow64/gi)?n="windows":t(/macintosh|macintel/gi)?n="osx":t(/x11/gi)?n="linux":t(/android|adr/gi)?n="android":t(/ios|iphone|ipad|ipod|iwatch/gi)&&(n="ios"),n}var ne=te();var ae=function(){var e=Object(o.f)();return Object(x.jsxs)("div",{className:"login-wrapper",children:[Object(x.jsxs)("div",{className:"login-form-wrapper",children:[Object(x.jsx)("div",{className:"title",children:"mushroom"}),Object(x.jsxs)("div",{className:"login-form",children:[Object(x.jsxs)("div",{className:"form-option",children:[Object(x.jsx)("h4",{children:"\u7528\u6237\u540d"}),Object(x.jsx)("input",{type:"text",id:"name",placeholder:"\u8f93\u5165\u7528\u6237\u540d",required:!0})]}),Object(x.jsxs)("div",{className:"form-option",style:{display:"none"},children:[Object(x.jsx)("h6",{children:"\u623f\u95f4\u53f7"}),Object(x.jsx)("input",{type:"text",id:"num",placeholder:"\u8f93\u5165\u623f\u95f4\u53f7",required:!0})]}),Object(x.jsxs)("div",{className:"form-option radio-option ".concat("oculus"===ne?"hiden":""),children:[Object(x.jsx)("span",{children:"\u89c2\u4f17\u8bbf\u95ee\uff1f"}),Object(x.jsx)("input",{type:"radio",id:"auth",name:"auth",value:"true"})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){var t=document.getElementById("name").value,n=document.getElementById("num").value,a="oculus"===ne||document.getElementById("auth").checked;e("/room",{state:{username:t,roomid:n,isAudience:a,browserType:ne}})},children:"\u8fdb\u5165\u623f\u95f4"}),Object(x.jsxs)("div",{className:"hide",children:[Object(x.jsx)("div",{children:te()}),Object(x.jsx)("div",{children:"webkitSpeechRecognition ".concat(window.webkitSpeechRecognition?"ok":"no")}),Object(x.jsx)("div",{children:"requestAnimationFrame ".concat(window.requestAnimationFrame?"ok":"no")}),Object(x.jsx)("div",{children:"requestVideoFrameCallback ".concat(document.createElement("video").requestVideoFrameCallback?"ok":"no")})]})]})]}),Object(x.jsxs)("div",{className:"login-img",children:[Object(x.jsxs)("div",{className:"info",children:[Object(x.jsx)("div",{className:"title",children:"mushroom"}),Object(x.jsx)("div",{children:"\u4e09\u7ef4\u89c6\u9891\u4f1a\u8bae\u5ba4"})]}),Object(x.jsx)("img",{src:"/viewfile.png",alt:"#"})]})]})};r.a.render(Object(x.jsx)(s.a,{children:Object(x.jsxs)(o.c,{children:[Object(x.jsx)(o.a,{path:"/",element:Object(x.jsx)(ae,{})}),Object(x.jsx)(o.a,{path:"/room",element:Object(x.jsx)(ee,{})})]})}),document.getElementById("root"))}},[[300,1,2]]]);
//# sourceMappingURL=main.da4296ee.chunk.js.map